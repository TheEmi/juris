<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris Component Composition Demo</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .demo-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .hero {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .hero h1 {
            margin: 0 0 15px 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .hero .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin: 0;
        }
        
        .status-bar {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .status-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 25px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .demo-section h3 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .pattern-example {
            background: white;
            border: 2px dashed #6c757d;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }
        
        .pattern-label {
            position: absolute;
            top: -12px;
            left: 20px;
            background: #6c757d;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .code-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 20px 0;
        }
        
        .controls button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .controls button.secondary {
            background: #6c757d;
        }
        
        .controls button.secondary:hover {
            background: #545b62;
        }
        
        /* Custom styles for composition patterns */
        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
        }
        
        .main-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .sidebar {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .nested-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .metric-row {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .highlight-box {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .composition-tree {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <h1>üé® Juris Component Composition</h1>
        <p class="subtitle">VDOM Objects + WebComponents = Perfect Harmony</p>
    </div>

    <!-- Framework Status -->
    <div class="demo-container">
        <h2>Framework Status</h2>
        <div id="framework-status" class="status-bar">
            <div class="loading"></div> Loading Juris Framework...
        </div>
    </div>

    <!-- Pattern 1: Pure VDOM with WebComponent Children -->
    <div class="demo-container">
        <h2>üèóÔ∏è Pattern 1: Pure VDOM Object with WebComponent Children</h2>
        <p>A normal Juris VDOM object that contains WebComponents as children</p>
        
        <div class="pattern-example">
            <div class="pattern-label">VDOM + WebComponents</div>
            <div id="pattern-1-demo">
                <!-- Pure VDOM object will render here with WebComponent children -->
            </div>
        </div>
        
        <div class="code-example">
// Pure VDOM object containing WebComponents
const dashboardLayout = {
    div: {
        className: 'dashboard-container',
        children: [
            {
                div: {
                    className: 'main-content',
                    children: [
                        { h2: { text: () => `Welcome ${context.getState('user.name', 'Guest')}` } },
                        
                        // ‚ú® WebComponents nested in VDOM
                        {
                            'comp-card': {
                                title: 'User Stats',
                                theme: 'primary',
                                children: [
                                    {
                                        'comp-counter': {
                                            slot: 'content',
                                            initial: () => context.getState('user.posts', 42),
                                            label: 'Posts'
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            }
        ]
    }
};
        </div>
    </div>

    <!-- Pattern 2: WebComponent with VDOM Children -->
    <div class="demo-container">
        <h2>üß© Pattern 2: WebComponent with Pure VDOM Children</h2>
        <p>WebComponents that contain pure VDOM objects as slot content</p>
        
        <div class="pattern-example">
            <div class="pattern-label">WebComponent + VDOM</div>
            
            <!-- WebComponent with VDOM children -->
            <comp-panel title="Analytics Dashboard">
                <!-- Pure VDOM as slot content -->
                <div slot="main" class="main-content">
                    <h3>Performance Metrics</h3>
                    <div id="vdom-metrics-container">
                        <!-- Pure VDOM metrics will be inserted here -->
                    </div>
                </div>
                
                <!-- Mixed content -->
                <comp-card slot="sidebar" title="Quick Actions" theme="info">
                    <comp-button slot="content" label="Refresh Data" variant="primary"></comp-button>
                    <comp-button slot="content" label="Export CSV" variant="secondary"></comp-button>
                </comp-card>
            </comp-panel>
        </div>
        
        <div class="code-example">
// WebComponent with pure VDOM as slot content
&lt;comp-panel title="Analytics Dashboard"&gt;
    &lt;!-- Pure VDOM objects as slot content --&gt;
    &lt;div slot="main"&gt;
        &lt;div id="metrics-container"&gt;&lt;/div&gt;
    &lt;/div&gt;
    
    &lt;!-- WebComponents in other slots --&gt;
    &lt;comp-card slot="sidebar" title="Actions"&gt;
        &lt;comp-button slot="content" label="Refresh"&gt;&lt;/comp-button&gt;
    &lt;/comp-card&gt;
&lt;/comp-panel&gt;

// VDOM objects inserted programmatically
const metricsVDOM = {
    div: {
        children: [
            { 
                div: { 
                    text: () => `Revenue: $${context.getState('metrics.revenue', 0)}`,
                    className: 'metric-item'
                } 
            },
            { 
                div: { 
                    text: () => `Users: ${context.getState('metrics.users', 0)}`,
                    className: 'metric-item'
                } 
            }
        ]
    }
};
        </div>
    </div>

    <!-- Pattern 3: Nested WebComponents -->
    <div class="demo-container">
        <h2>ü™Ü Pattern 3: Deep WebComponent Nesting</h2>
        <p>WebComponents containing other WebComponents with multiple slot levels</p>
        
        <div class="pattern-example">
            <div class="pattern-label">Deep Nesting</div>
            
            <comp-dashboard>
                <comp-panel slot="main" title="User Management">
                    <comp-card slot="content" title="User Details" theme="success">
                        <comp-avatar slot="header" name="John Doe" size="50"></comp-avatar>
                        <div slot="content">
                            <comp-counter initial="125" label="Friends" theme="compact"></comp-counter>
                            <comp-counter initial="89" label="Posts" theme="compact"></comp-counter>
                        </div>
                        <comp-button slot="actions" label="Edit Profile" variant="primary"></comp-button>
                        <comp-button slot="actions" label="Send Message" variant="secondary"></comp-button>
                    </comp-card>
                </comp-panel>
                
                <comp-panel slot="sidebar" title="Recent Activity">
                    <div slot="content" id="activity-feed">
                        <!-- VDOM activity items will be inserted here -->
                    </div>
                </comp-panel>
            </comp-dashboard>
        </div>
        
        <div class="code-example">
// Deep nesting with multiple component types
&lt;comp-dashboard&gt;
    &lt;comp-panel slot="main" title="User Management"&gt;
        &lt;comp-card slot="content" title="User Details"&gt;
            &lt;comp-avatar slot="header" name="John Doe"&gt;&lt;/comp-avatar&gt;
            &lt;div slot="content"&gt;
                &lt;comp-counter label="Friends"&gt;&lt;/comp-counter&gt;
                &lt;comp-counter label="Posts"&gt;&lt;/comp-counter&gt;
            &lt;/div&gt;
            &lt;comp-button slot="actions" label="Edit"&gt;&lt;/comp-button&gt;
        &lt;/comp-card&gt;
    &lt;/comp-panel&gt;
&lt;/comp-dashboard&gt;
        </div>
    </div>

    <!-- Pattern 4: Dynamic Composition -->
    <div class="demo-container">
        <h2>‚ö° Pattern 4: Dynamic Component Composition</h2>
        <p>Components created and composed dynamically based on state</p>
        
        <div class="pattern-example">
            <div class="pattern-label">Dynamic Composition</div>
            <div id="dynamic-composition-demo">
                <!-- Dynamic content will be rendered here -->
            </div>
        </div>
        
        <div class="controls">
            <button onclick="addDynamicWidget()">Add Widget</button>
            <button onclick="changeLayout()" class="secondary">Change Layout</button>
            <button onclick="toggleTheme()" class="secondary">Toggle Theme</button>
            <button onclick="clearWidgets()" class="secondary">Clear All</button>
        </div>
        
        <div class="code-example">
// Dynamic composition based on state
const dynamicLayout = {
    div: {
        className: () => `layout-${context.getState('app.layout', 'grid')}`,
        children: () => {
            const widgets = context.getState('app.widgets', []);
            return widgets.map((widget, index) => ({
                'comp-widget': {
                    key: widget.id,
                    type: widget.type,
                    title: widget.title,
                    theme: () => context.getState('app.theme', 'light'),
                    children: widget.content.map(item => ({
                        [item.component]: {
                            slot: item.slot,
                            ...item.props
                        }
                    }))
                }
            }));
        }
    }
};
        </div>
    </div>

    <!-- Pattern 5: Conditional Composition -->
    <div class="demo-container">
        <h2>üîÄ Pattern 5: Conditional Component Composition</h2>
        <p>Different component structures based on application state</p>
        
        <div class="pattern-example">
            <div class="pattern-label">Conditional Composition</div>
            <div id="conditional-composition-demo">
                <!-- Conditional content will be rendered here -->
            </div>
        </div>
        
        <div class="controls">
            <button onclick="toggleUserLogin()">Toggle Login State</button>
            <button onclick="switchUserRole()" class="secondary">Switch User Role</button>
            <button onclick="toggleMobileView()" class="secondary">Toggle Mobile View</button>
        </div>
        
        <div class="code-example">
// Conditional composition based on multiple state factors
const conditionalApp = {
    div: {
        className: 'app-container',
        children: () => {
            const isLoggedIn = context.getState('user.loggedIn', false);
            const userRole = context.getState('user.role', 'guest');
            const isMobile = context.getState('app.isMobile', false);
            
            if (!isLoggedIn) {
                return [
                    { 'comp-header': { title: 'Welcome' } },
                    { 'comp-login-form': {} }
                ];
            }
            
            if (isMobile) {
                return [
                    { 'comp-mobile-nav': {} },
                    { 'comp-mobile-content': { userRole } }
                ];
            }
            
            return [
                { 'comp-header': { title: () => `Welcome ${context.getState('user.name')}` } },
                {
                    'comp-main-layout': {
                        children: userRole === 'admin' ? [
                            { 'comp-admin-panel': { slot: 'sidebar' } },
                            { 'comp-dashboard': { slot: 'main', role: 'admin' } }
                        ] : [
                            { 'comp-user-menu': { slot: 'sidebar' } },
                            { 'comp-dashboard': { slot: 'main', role: 'user' } }
                        ]
                    }
                }
            ];
        }
    }
};
        </div>
    </div>

    <!-- Composition Tree Visualization -->
    <div class="demo-container">
        <h2>üå≥ Component Composition Tree</h2>
        <p>Visual representation of how components are nested and composed</p>
        
        <div class="composition-tree" id="composition-tree">
            <!-- Tree visualization will be generated here -->
        </div>
        
        <div class="controls">
            <button onclick="analyzeComposition()">Analyze Current Composition</button>
            <button onclick="showCompositionStats()" class="secondary">Show Stats</button>
        </div>
    </div>

    <!-- Performance Insights -->
    <div class="demo-container">
        <h2>üìä Composition Performance Insights</h2>
        <p>Understanding the performance implications of different composition patterns</p>
        
        <div class="highlight-box">
            <h4>üéØ Key Insights:</h4>
            <ul>
                <li><strong>VDOM Objects:</strong> Direct Juris rendering, optimal performance</li>
                <li><strong>WebComponents:</strong> Shadow DOM isolation, great for encapsulation</li>
                <li><strong>Mixed Composition:</strong> Best of both worlds - performance + encapsulation</li>
                <li><strong>Fine-grained Reactivity:</strong> Works seamlessly across all component types</li>
            </ul>
        </div>
        
        <div id="performance-stats">
            <!-- Performance metrics will be displayed here -->
        </div>
    </div>

    <!-- Load Juris Framework -->
    <script src="../src/juris.js"></script>
    
    <script>
        // Global variables for demo
        let juris = null;
        let demoContext = null;

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeCompositionDemo();
        });

        async function initializeCompositionDemo() {
            try {
                // Check if Juris is loaded
                if (typeof Juris === 'undefined') {
                    updateStatus('‚ùå Juris framework not found. Please check the script path.', 'error');
                    return;
                }

                updateStatus('‚úÖ Juris framework loaded successfully!', 'success');
                
                // Initialize Juris instance with composition-focused state
                juris = new Juris({
                    states: {
                        user: {
                            name: 'Alice Johnson',
                            loggedIn: true,
                            role: 'admin',
                            posts: 42,
                            followers: 128,
                            friends: 89
                        },
                        app: {
                            theme: 'light',
                            layout: 'grid',
                            isMobile: false,
                            widgets: [
                                {
                                    id: 'widget-1',
                                    type: 'stats',
                                    title: 'User Stats',
                                    content: [
                                        { component: 'comp-counter', slot: 'content', props: { initial: 42, label: 'Posts' } }
                                    ]
                                }
                            ]
                        },
                        metrics: {
                            revenue: 125000,
                            users: 1543,
                            conversions: 89
                        },
                        activity: [
                            { id: 1, user: 'John', action: 'posted', time: '2 min ago' },
                            { id: 2, user: 'Sarah', action: 'commented', time: '5 min ago' },
                            { id: 3, user: 'Mike', action: 'liked', time: '8 min ago' }
                        ]
                    }
                });

                // Create context for composition patterns
                demoContext = juris.createContext();
                
                // Create all demo WebComponents
                await createCompositionComponents();
                
                // Render composition patterns
                renderCompositionPatterns();
                
                updateStatus('üéâ All composition patterns ready!', 'success');
                
            } catch (error) {
                console.error('Demo initialization error:', error);
                updateStatus(`‚ùå Initialization failed: ${error.message}`, 'error');
            }
        }

        async function createCompositionComponents() {
            // Card Component for composition
            juris.createWebComponent('comp-card', (props, context) => {
                const title = props.title || 'Card';
                const theme = props.theme || 'default';
                
                const themes = {
                    primary: { bg: '#007bff', text: 'white' },
                    success: { bg: '#28a745', text: 'white' },
                    info: { bg: '#17a2b8', text: 'white' },
                    default: { bg: '#f8f9fa', text: '#333' }
                };
                
                const colors = themes[theme] || themes.default;
                
                return {
                    div: {
                        className: 'comp-card',
                        style: {
                            background: colors.bg,
                            color: colors.text,
                            borderRadius: '8px',
                            overflow: 'hidden',
                            margin: '10px',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)'
                        },
                        children: [
                            {
                                div: {
                                    className: 'card-header',
                                    style: {
                                        padding: '15px',
                                        borderBottom: '1px solid rgba(255,255,255,0.2)',
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '10px',
                                        fontWeight: 'bold'
                                    },
                                    children: [
                                        { slot: { name: 'header' } },
                                        { span: { text: title } }
                                    ]
                                }
                            },
                            {
                                div: {
                                    className: 'card-content',
                                    style: { padding: '15px' },
                                    children: [{ slot: { name: 'content' } }]
                                }
                            },
                            {
                                div: {
                                    className: 'card-actions',
                                    style: {
                                        padding: '10px 15px',
                                        borderTop: '1px solid rgba(255,255,255,0.2)',
                                        display: 'flex',
                                        gap: '10px'
                                    },
                                    children: [{ slot: { name: 'actions' } }]
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['title', 'theme'],
                autoRerender: false
            });

            // Counter Component
            juris.createWebComponent('comp-counter', (props, context) => {
                const theme = props.theme || 'primary';
                
                return {
                    div: {
                        className: `comp-counter theme-${theme}`,
                        style: {
                            padding: theme === 'compact' ? '10px' : '15px',
                            border: '2px solid #007bff',
                            borderRadius: '8px',
                            background: 'linear-gradient(135deg, #007bff, #0056b3)',
                            color: 'white',
                            textAlign: 'center',
                            margin: '10px',
                            display: 'inline-block',
                            minWidth: '120px'
                        },
                        children: [
                            {
                                div: {
                                    text: props.label || 'Count',
                                    style: { fontSize: '12px', marginBottom: '5px' }
                                }
                            },
                            {
                                div: {
                                    text: () => context.component.getState('count', parseInt(props.initial) || 0).toString(),
                                    style: { fontSize: '20px', fontWeight: 'bold', margin: '5px 0' }
                                }
                            },
                            {
                                div: {
                                    style: { display: 'flex', justifyContent: 'center', gap: '5px' },
                                    children: [
                                        {
                                            button: {
                                                text: '‚àí',
                                                onclick: () => {
                                                    const current = context.component.getState('count', parseInt(props.initial) || 0);
                                                    context.component.setState('count', current - 1);
                                                },
                                                style: {
                                                    background: 'white',
                                                    color: '#007bff',
                                                    border: 'none',
                                                    padding: '4px 8px',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer'
                                                }
                                            }
                                        },
                                        {
                                            button: {
                                                text: '+',
                                                onclick: () => {
                                                    const current = context.component.getState('count', parseInt(props.initial) || 0);
                                                    context.component.setState('count', current + 1);
                                                },
                                                style: {
                                                    background: 'white',
                                                    color: '#007bff',
                                                    border: 'none',
                                                    padding: '4px 8px',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer'
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['initial', 'label', 'theme'],
                autoRerender: false
            });

            // Button Component
            juris.createWebComponent('comp-button', (props, context) => {
                const variant = props.variant || 'primary';
                const variants = {
                    primary: '#007bff',
                    secondary: '#6c757d',
                    success: '#28a745',
                    danger: '#dc3545'
                };
                
                return {
                    button: {
                        text: () => {
                            const clicked = context.component.getState('clicked', false);
                            return clicked ? `‚úì ${props.label}` : props.label || 'Button';
                        },
                        onclick: () => {
                            const current = context.component.getState('clicked', false);
                            context.component.setState('clicked', !current);
                            context.component.emit('comp-button-click', { label: props.label });
                        },
                        style: {
                            background: variants[variant],
                            color: 'white',
                            border: 'none',
                            padding: '8px 16px',
                            borderRadius: '4px',
                            cursor: 'pointer',
                            margin: '5px',
                            transition: 'transform 0.1s'
                        },
                        onmouseenter: (e) => e.target.style.transform = 'translateY(-1px)',
                        onmouseleave: (e) => e.target.style.transform = 'translateY(0)'
                    }
                };
            }, {
                attributes: ['label', 'variant'],
                autoRerender: false
            });

            // Avatar Component
            juris.createWebComponent('comp-avatar', (props, context) => {
                const name = props.name || 'User';
                const size = props.size || '40';
                const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                return {
                    div: {
                        className: 'comp-avatar',
                        style: {
                            width: size + 'px',
                            height: size + 'px',
                            borderRadius: '50%',
                            background: 'linear-gradient(135deg, #667eea, #764ba2)',
                            color: 'white',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontWeight: 'bold',
                            fontSize: Math.floor(size / 3) + 'px'
                        },
                        children: [
                            { span: { text: initials } }
                        ]
                    }
                };
            }, {
                attributes: ['name', 'size'],
                autoRerender: false
            });

            // Panel Component
            juris.createWebComponent('comp-panel', (props, context) => {
                const title = props.title || 'Panel';
                
                return {
                    div: {
                        className: 'comp-panel',
                        style: {
                            border: '2px solid #007bff',
                            borderRadius: '8px',
                            background: 'white',
                            overflow: 'hidden',
                            margin: '10px 0'
                        },
                        children: [
                            {
                                div: {
                                    className: 'panel-header',
                                    text: title,
                                    style: {
                                        background: '#007bff',
                                        color: 'white',
                                        padding: '15px',
                                        fontWeight: 'bold'
                                    }
                                }
                            },
                            {
                                div: {
                                    className: 'panel-content',
                                    style: { padding: '15px' },
                                    children: [{ slot: { name: 'content' } }]
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['title'],
                autoRerender: false
            });

            // Dashboard Component
            juris.createWebComponent('comp-dashboard', (props, context) => {
                return {
                    div: {
                        className: 'comp-dashboard',
                        style: {
                            display: 'grid',
                            gridTemplateColumns: '2fr 1fr',
                            gap: '20px',
                            margin: '20px 0'
                        },
                        children: [
                            {
                                div: {
                                    className: 'dashboard-main',
                                    children: [{ slot: { name: 'main' } }]
                                }
                            },
                            {
                                div: {
                                    className: 'dashboard-sidebar',
                                    children: [{ slot: { name: 'sidebar' } }]
                                }
                            }
                        ]
                    }
                };
            }, {
                autoRerender: false,
                styles: `
                    @media (max-width: 768px) {
                        .comp-dashboard {
                            grid-template-columns: 1fr !important;
                        }
                    }
                `
            });

            // Widget Component for dynamic composition
            juris.createWebComponent('comp-widget', (props, context) => {
                const type = props.type || 'default';
                const title = props.title || 'Widget';
                const theme = props.theme || 'light';
                
                return {
                    div: {
                        className: `comp-widget widget-${type} theme-${theme}`,
                        style: {
                            background: theme === 'dark' ? '#343a40' : 'white',
                            color: theme === 'dark' ? 'white' : '#333',
                            border: '1px solid #dee2e6',
                            borderRadius: '8px',
                            padding: '15px',
                            margin: '10px',
                            boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                        },
                        children: [
                            {
                                h4: {
                                    text: title,
                                    style: { marginTop: 0, borderBottom: '1px solid #dee2e6', paddingBottom: '10px' }
                                }
                            },
                            {
                                div: {
                                    className: 'widget-content',
                                    children: [{ slot: { name: 'content' } }]
                                }
                            }
                        ]
                    }
                };
            }, {
                attributes: ['type', 'title', 'theme'],
                autoRerender: false
            });
        }

        function renderCompositionPatterns() {
            // Pattern 1: Pure VDOM with WebComponent children
            const pattern1VDOM = {
                div: {
                    className: 'dashboard-container',
                    children: [
                        {
                            div: {
                                className: 'main-content',
                                children: [
                                    {
                                        h2: {
                                            text: () => `Welcome ${demoContext.getState('user.name', 'Guest')}`,
                                            style: { color: '#007bff', marginBottom: '20px' }
                                        }
                                    },
                                    // WebComponent nested in VDOM
                                    {
                                        'comp-card': {
                                            title: 'User Statistics',
                                            theme: 'primary'
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            div: {
                                className: 'sidebar',
                                children: [
                                    {
                                        h3: {
                                            text: 'Quick Actions',
                                            style: { marginTop: 0 }
                                        }
                                    },
                                    {
                                        'comp-button': {
                                            label: 'Refresh',
                                            variant: 'primary'
                                        }
                                    },
                                    {
                                        'comp-button': {
                                            label: 'Settings',
                                            variant: 'secondary'
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            };

            // Render Pattern 1
            const pattern1Element = juris.objectToHtml(pattern1VDOM);
            document.getElementById('pattern-1-demo').appendChild(pattern1Element);

            // Pattern 2: Insert VDOM into WebComponent slots
            const metricsVDOM = {
                div: {
                    className: 'nested-grid',
                    children: [
                        {
                            div: {
                                className: 'metric-item',
                                style: {
                                    background: '#28a745',
                                    color: 'white',
                                    padding: '15px',
                                    borderRadius: '6px',
                                    textAlign: 'center'
                                },
                                children: [
                                    {
                                        div: {
                                            text: () => `$${demoContext.getState('metrics.revenue', 0).toLocaleString()}`,
                                            style: { fontSize: '20px', fontWeight: 'bold' }
                                        }
                                    },
                                    {
                                        div: {
                                            text: 'Revenue',
                                            style: { fontSize: '12px', opacity: '0.9' }
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            div: {
                                className: 'metric-item',
                                style: {
                                    background: '#17a2b8',
                                    color: 'white',
                                    padding: '15px',
                                    borderRadius: '6px',
                                    textAlign: 'center'
                                },
                                children: [
                                    {
                                        div: {
                                            text: () => demoContext.getState('metrics.users', 0).toLocaleString(),
                                            style: { fontSize: '20px', fontWeight: 'bold' }
                                        }
                                    },
                                    {
                                        div: {
                                            text: 'Active Users',
                                            style: { fontSize: '12px', opacity: '0.9' }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            };

            // Insert VDOM into WebComponent slot
            const metricsElement = juris.objectToHtml(metricsVDOM);
            document.getElementById('vdom-metrics-container').appendChild(metricsElement);

            // Pattern 4: Dynamic composition
            renderDynamicComposition();

            // Pattern 5: Conditional composition
            renderConditionalComposition();

            // Activity feed VDOM
            const activityVDOM = {
                div: {
                    children: () => {
                        const activities = demoContext.getState('activity', []);
                        return activities.map(activity => ({
                            div: {
                                style: {
                                    background: '#f8f9fa',
                                    padding: '10px',
                                    margin: '5px 0',
                                    borderRadius: '4px',
                                    borderLeft: '3px solid #007bff'
                                },
                                children: [
                                    {
                                        span: {
                                            text: `${activity.user} ${activity.action}`,
                                            style: { fontWeight: '500' }
                                        }
                                    },
                                    {
                                        span: {
                                            text: ` ‚Ä¢ ${activity.time}`,
                                            style: { color: '#6c757d', fontSize: '12px' }
                                        }
                                    }
                                ]
                            }
                        }));
                    }
                }
            };

            const activityElement = juris.objectToHtml(activityVDOM);
            document.getElementById('activity-feed').appendChild(activityElement);
        }

        function renderDynamicComposition() {
            const dynamicVDOM = {
                div: {
                    className: () => `layout-${demoContext.getState('app.layout', 'grid')}`,
                    style: {
                        display: 'grid',
                        gridTemplateColumns: () => demoContext.getState('app.layout', 'grid') === 'grid' ? 'repeat(auto-fit, minmax(300px, 1fr))' : '1fr',
                        gap: '15px'
                    },
                    children: () => {
                        const widgets = demoContext.getState('app.widgets', []);
                        return widgets.map(widget => ({
                            'comp-widget': {
                                key: widget.id,
                                type: widget.type,
                                title: widget.title,
                                theme: () => demoContext.getState('app.theme', 'light')
                            }
                        }));
                    }
                }
            };

            const dynamicElement = juris.objectToHtml(dynamicVDOM);
            document.getElementById('dynamic-composition-demo').appendChild(dynamicElement);
        }

        function renderConditionalComposition() {
            const conditionalVDOM = {
                div: {
                    className: 'conditional-app',
                    children: () => {
                        const isLoggedIn = demoContext.getState('user.loggedIn', false);
                        const userRole = demoContext.getState('user.role', 'guest');
                        const isMobile = demoContext.getState('app.isMobile', false);

                        if (!isLoggedIn) {
                            return [
                                {
                                    div: {
                                        style: {
                                            background: '#f8d7da',
                                            color: '#721c24',
                                            padding: '20px',
                                            borderRadius: '8px',
                                            textAlign: 'center'
                                        },
                                        children: [
                                            { h3: { text: 'Please log in to continue' } },
                                            {
                                                'comp-button': {
                                                    label: 'Login',
                                                    variant: 'primary'
                                                }
                                            }
                                        ]
                                    }
                                }
                            ];
                        }

                        if (isMobile) {
                            return [
                                {
                                    div: {
                                        style: {
                                            background: '#d1ecf1',
                                            color: '#0c5460',
                                            padding: '15px',
                                            borderRadius: '8px',
                                            textAlign: 'center'
                                        },
                                        text: 'üì± Mobile Layout Active'
                                    }
                                },
                                {
                                    'comp-card': {
                                        title: 'Mobile Dashboard',
                                        theme: 'info'
                                    }
                                }
                            ];
                        }

                        return [
                            {
                                div: {
                                    style: {
                                        background: '#d4edda',
                                        color: '#155724',
                                        padding: '15px',
                                        borderRadius: '8px',
                                        marginBottom: '15px'
                                    },
                                    children: [
                                        {
                                            span: {
                                                text: () => `Welcome ${demoContext.getState('user.name')} (${userRole.toUpperCase()})`
                                            }
                                        }
                                    ]
                                }
                            },
                            userRole === 'admin' ? {
                                'comp-card': {
                                    title: 'Admin Panel',
                                    theme: 'danger'
                                }
                            } : {
                                'comp-card': {
                                    title: 'User Dashboard',
                                    theme: 'success'
                                }
                            }
                        ];
                    }
                }
            };

            const conditionalElement = juris.objectToHtml(conditionalVDOM);
            document.getElementById('conditional-composition-demo').appendChild(conditionalElement);
        }

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('framework-status');
            statusEl.innerHTML = message;
            statusEl.className = `status-bar status-${type}`;
        }

        // Demo control functions
        function addDynamicWidget() {
            const widgets = juris.getState('app.widgets', []);
            const newWidget = {
                id: `widget-${Date.now()}`,
                type: 'dynamic',
                title: `Dynamic Widget ${widgets.length + 1}`,
                content: []
            };
            juris.setState('app.widgets', [...widgets, newWidget]);
        }

        function changeLayout() {
            const currentLayout = juris.getState('app.layout', 'grid');
            const newLayout = currentLayout === 'grid' ? 'column' : 'grid';
            juris.setState('app.layout', newLayout);
        }

        function toggleTheme() {
            const currentTheme = juris.getState('app.theme', 'light');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            juris.setState('app.theme', newTheme);
        }

        function clearWidgets() {
            juris.setState('app.widgets', []);
        }

        function toggleUserLogin() {
            const currentLogin = juris.getState('user.loggedIn', false);
            juris.setState('user.loggedIn', !currentLogin);
        }

        function switchUserRole() {
            const currentRole = juris.getState('user.role', 'user');
            const newRole = currentRole === 'admin' ? 'user' : 'admin';
            juris.setState('user.role', newRole);
        }

        function toggleMobileView() {
            const currentMobile = juris.getState('app.isMobile', false);
            juris.setState('app.isMobile', !currentMobile);
        }

        function analyzeComposition() {
            const tree = generateCompositionTree();
            document.getElementById('composition-tree').innerHTML = tree;
        }

        function generateCompositionTree() {
            return `
üì¶ Application Root (VDOM Object)
‚îú‚îÄ‚îÄ üèóÔ∏è Pattern 1: Pure VDOM + WebComponents
‚îÇ   ‚îú‚îÄ‚îÄ div.dashboard-container (VDOM)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ div.main-content (VDOM)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ h2 (VDOM with reactive text)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ comp-card (WebComponent)
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [Shadow DOM content]
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ div.sidebar (VDOM)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ h3 (VDOM)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ comp-button (WebComponent)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ comp-button (WebComponent)
‚îÇ   
‚îú‚îÄ‚îÄ üß© Pattern 2: WebComponent + VDOM Children
‚îÇ   ‚îî‚îÄ‚îÄ comp-panel (WebComponent)
‚îÇ       ‚îú‚îÄ‚îÄ [Shadow DOM structure]
‚îÇ       ‚îú‚îÄ‚îÄ slot[main] ‚Üí div (VDOM metrics)
‚îÇ       ‚îî‚îÄ‚îÄ slot[sidebar] ‚Üí comp-card (WebComponent)
‚îÇ   
‚îú‚îÄ‚îÄ ü™Ü Pattern 3: Deep WebComponent Nesting
‚îÇ   ‚îî‚îÄ‚îÄ comp-dashboard (WebComponent)
‚îÇ       ‚îú‚îÄ‚îÄ slot[main] ‚Üí comp-panel (WebComponent)
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ slot[content] ‚Üí comp-card (WebComponent)
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ slot[header] ‚Üí comp-avatar (WebComponent)
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ slot[content] ‚Üí comp-counter (WebComponent)
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ slot[actions] ‚Üí comp-button (WebComponent)
‚îÇ       ‚îî‚îÄ‚îÄ slot[sidebar] ‚Üí comp-panel (WebComponent)
‚îÇ           ‚îî‚îÄ‚îÄ slot[content] ‚Üí div (VDOM activity feed)
‚îÇ   
‚îú‚îÄ‚îÄ ‚ö° Pattern 4: Dynamic Composition (VDOM)
‚îÇ   ‚îî‚îÄ‚îÄ div (reactive layout class)
‚îÇ       ‚îî‚îÄ‚îÄ comp-widget[] (dynamic WebComponent array)
‚îÇ   
‚îî‚îÄ‚îÄ üîÄ Pattern 5: Conditional Composition (VDOM)
    ‚îî‚îÄ‚îÄ div.conditional-app (VDOM)
        ‚îî‚îÄ‚îÄ children[] (conditional component tree)
            `;
        }

        function showCompositionStats() {
            const stats = {
                vdomObjects: document.querySelectorAll('[data-juris-vdom]').length,
                webComponents: document.querySelectorAll('[data-juris-enhanced]').length,
                shadowRoots: document.querySelectorAll('*').length, // Approximation
                reactiveAttributes: 'Many (tracked automatically)'
            };

            document.getElementById('performance-stats').innerHTML = `
                <div class="highlight-box">
                    <h4>üìä Current Composition Stats:</h4>
                    <ul>
                        <li><strong>VDOM Objects:</strong> Dynamic (rendered on-demand)</li>
                        <li><strong>WebComponents:</strong> ${document.querySelectorAll('[is]').length || 'Multiple'} registered types</li>
                        <li><strong>Shadow DOM Boundaries:</strong> ${document.querySelectorAll('comp-card, comp-panel, comp-dashboard').length || 'Multiple'}</li>
                        <li><strong>Reactive Elements:</strong> All function attributes auto-tracked</li>
                        <li><strong>Mixed Composition:</strong> ‚úÖ VDOM + WebComponents seamlessly integrated</li>
                    </ul>
                </div>
            `;
        }
    </script>
</body>
</html>
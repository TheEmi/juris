<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris Advanced Router Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .demo-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .demo-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .demo-header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .navigation {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }

        .nav-links {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s ease;
            color: #666;
            font-weight: 500;
        }

        .nav-link:hover {
            background: #f0f0f0;
            color: #333;
        }

        .nav-link.router-link-active {
            background: #667eea;
            color: white;
        }

        .content-area {
            background: white;
            min-height: 400px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .page-content {
            padding: 2rem;
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #333;
        }

        .page-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 1.5rem;
        }

        .demo-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .demo-section h3 {
            margin-bottom: 1rem;
            color: #333;
        }

        .param-display {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .router-loading {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .router-error {
            text-align: center;
            padding: 3rem;
            color: #dc3545;
        }

        .router-not-found {
            text-align: center;
            padding: 3rem;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0.25rem;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .admin-sidebar {
            background: #343a40;
            color: white;
            min-height: 300px;
            padding: 1rem;
        }

        .admin-content {
            padding: 2rem;
            flex: 1;
        }

        .admin-layout {
            display: flex;
        }

        .transition-fadeIn {
            animation: fadeIn 0.3s ease-in;
        }

        .transition-fadeOut {
            animation: fadeOut 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }

        .router-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            max-width: 300px;
            z-index: 1000;
        }

        .router-info h4 {
            margin-bottom: 0.5rem;
            color: #667eea;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .auth-status {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 999;
        }

        .auth-status.authenticated {
            background: rgba(40, 167, 69, 0.9);
        }

        .auth-status.unauthenticated {
            background: rgba(220, 53, 69, 0.9);
        }

        .protected-route-notice {
            background: #fff3cd;
            color: #856404;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        @media (max-width: 768px) {
            .nav-links {
                flex-direction: column;
                align-items: stretch;
            }
            
            .admin-layout {
                flex-direction: column;
            }
            
            .router-info {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- App will be rendered here -->
    </div>

    <!-- Router Info Panel -->
    <div class="router-info" id="routerInfo">
        <h4>üîç Router State</h4>
        <div id="routerDetails">Loading...</div>
    </div>

    <!-- Auth Status Panel -->
    <div class="auth-status" id="authStatus">
        <div id="authDetails">Loading...</div>
    </div>

    <!-- Load Juris Framework -->
    <script src="juris.js"></script>

    <script>
        // Demo Components
        const components = {
            // Navigation Component
            Navigation: (props, context) => ({
                nav: {
                    className: 'navigation',
                    children: [{
                        div: {
                            className: 'nav-links',
                            children: () => {
                                const isAuthenticated = context.getState('auth.isAuthenticated', false);
                                const currentUser = context.getState('auth.user', null);
                                
                                const publicLinks = [
                                    {
                                        RouterLink: {
                                            to: '/',
                                            exact: true,
                                            text: 'üè† Home'
                                        }
                                    },
                                    {
                                        RouterLink: {
                                            to: '/about',
                                            text: 'üìñ About'
                                        }
                                    },
                                    {
                                        RouterLink: {
                                            to: '/users',
                                            text: 'üë• Users'
                                        }
                                    },
                                    {
                                        RouterLink: {
                                            to: '/products/electronics',
                                            text: 'üì± Electronics'
                                        }
                                    },
                                    {
                                        RouterLink: {
                                            to: '/search?q=demo&page=1',
                                            text: 'üîç Search Demo'
                                        }
                                    }
                                ];

                                const authLinks = isAuthenticated ? [
                                    {
                                        RouterLink: {
                                            to: '/profile',
                                            text: `üë§ ${currentUser?.name || 'Profile'}`
                                        }
                                    },
                                    {
                                        RouterLink: {
                                            to: '/admin',
                                            text: '‚öôÔ∏è Admin'
                                        }
                                    },
                                    {
                                        a: {
                                            href: '#',
                                            className: 'nav-link',
                                            text: 'üö™ Logout',
                                            onClick: (e) => {
                                                e.preventDefault();
                                                authService.logout();
                                                context.navigate('/');
                                            }
                                        }
                                    }
                                ] : [
                                    {
                                        RouterLink: {
                                            to: '/login',
                                            text: 'üîë Login'
                                        }
                                    },
                                    {
                                        RouterLink: {
                                            to: '/register',
                                            text: 'üìù Register'
                                        }
                                    }
                                ];

                                const utilityLinks = [
                                    {
                                        a: {
                                            href: '#',
                                            className: 'nav-link',
                                            text: 'üîÑ Force Reload',
                                            onClick: (e) => {
                                                e.preventDefault();
                                                context.navigate(context.getState('router.currentRoute'), { force: true });
                                            }
                                        }
                                    }
                                ];

                                return [...publicLinks, ...authLinks, ...utilityLinks];
                            }
                        }
                    }]
                }
            }),

            // Login Page Component
            LoginPage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: [
                        {
                            h1: {
                                className: 'page-title',
                                text: 'üîë Login'
                            }
                        },
                        {
                            p: {
                                className: 'page-subtitle',
                                text: 'Sign in to access protected routes and features.'
                            }
                        },
                        {
                            div: {
                                className: 'login-form',
                                children: () => {
                                    const isLoading = context.getState('auth.isLoading', false);
                                    const error = context.getState('auth.error', null);
                                    
                                    return [
                                        error ? {
                                            div: {
                                                className: 'error-message',
                                                text: error
                                            }
                                        } : null,
                                        {
                                            form: {
                                                onSubmit: (e) => {
                                                    e.preventDefault();
                                                    const formData = new FormData(e.target);
                                                    const username = formData.get('username');
                                                    const password = formData.get('password');
                                                    
                                                    authService.login(username, password)
                                                        .then(() => {
                                                            const returnUrl = context.getState('router.query.returnUrl', '/');
                                                            context.navigate(returnUrl);
                                                        })
                                                        .catch(err => {
                                                            console.error('Login failed:', err);
                                                        });
                                                },
                                                children: [
                                                    {
                                                        div: {
                                                            className: 'form-group',
                                                            children: [
                                                                {
                                                                    label: { 
                                                                        text: 'Username:',
                                                                        htmlFor: 'username'
                                                                    }
                                                                },
                                                                {
                                                                    input: {
                                                                        type: 'text',
                                                                        name: 'username',
                                                                        id: 'username',
                                                                        className: 'form-control',
                                                                        placeholder: 'Enter username (try: admin, user, demo)',
                                                                        required: true,
                                                                        disabled: isLoading
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            className: 'form-group',
                                                            children: [
                                                                {
                                                                    label: { 
                                                                        text: 'Password:',
                                                                        htmlFor: 'password'
                                                                    }
                                                                },
                                                                {
                                                                    input: {
                                                                        type: 'password',
                                                                        name: 'password',
                                                                        id: 'password',
                                                                        className: 'form-control',
                                                                        placeholder: 'Enter password (try: password)',
                                                                        required: true,
                                                                        disabled: isLoading
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            children: [
                                                                {
                                                                    button: {
                                                                        type: 'submit',
                                                                        className: 'btn',
                                                                        disabled: isLoading,
                                                                        text: isLoading ? 'Logging in...' : 'Login'
                                                                    }
                                                                },
                                                                {
                                                                    RouterLink: {
                                                                        to: '/register',
                                                                        className: 'btn btn-secondary',
                                                                        text: 'Register Instead'
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            div: {
                                                className: 'demo-section',
                                                children: [
                                                    {
                                                        h3: { text: 'üß™ Demo Credentials' }
                                                    },
                                                    {
                                                        p: { text: 'Try these demo accounts:' }
                                                    },
                                                    {
                                                        ul: {
                                                            children: [
                                                                { li: { text: 'admin / password (Admin access)' } },
                                                                { li: { text: 'user / password (Regular user)' } },
                                                                { li: { text: 'demo / password (Demo user)' } }
                                                            ]
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    ].filter(Boolean);
                                }
                            }
                        }
                    ]
                }
            }),

            // Register Page Component
            RegisterPage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: [
                        {
                            h1: {
                                className: 'page-title',
                                text: 'üìù Register'
                            }
                        },
                        {
                            p: {
                                className: 'page-subtitle',
                                text: 'Create a new account to access all features.'
                            }
                        },
                        {
                            div: {
                                className: 'login-form',
                                children: () => {
                                    const isLoading = context.getState('auth.isLoading', false);
                                    const error = context.getState('auth.error', null);
                                    
                                    return [
                                        error ? {
                                            div: {
                                                className: 'error-message',
                                                text: error
                                            }
                                        } : null,
                                        {
                                            form: {
                                                onSubmit: (e) => {
                                                    e.preventDefault();
                                                    const formData = new FormData(e.target);
                                                    const userData = {
                                                        username: formData.get('username'),
                                                        email: formData.get('email'),
                                                        password: formData.get('password'),
                                                        confirmPassword: formData.get('confirmPassword')
                                                    };
                                                    
                                                    authService.register(userData)
                                                        .then(() => {
                                                            context.navigate('/');
                                                        })
                                                        .catch(err => {
                                                            console.error('Registration failed:', err);
                                                        });
                                                },
                                                children: [
                                                    {
                                                        div: {
                                                            className: 'form-group',
                                                            children: [
                                                                {
                                                                    label: { 
                                                                        text: 'Username:',
                                                                        htmlFor: 'username'
                                                                    }
                                                                },
                                                                {
                                                                    input: {
                                                                        type: 'text',
                                                                        name: 'username',
                                                                        id: 'username',
                                                                        className: 'form-control',
                                                                        placeholder: 'Choose a username',
                                                                        required: true,
                                                                        disabled: isLoading
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            className: 'form-group',
                                                            children: [
                                                                {
                                                                    label: { 
                                                                        text: 'Email:',
                                                                        htmlFor: 'email'
                                                                    }
                                                                },
                                                                {
                                                                    input: {
                                                                        type: 'email',
                                                                        name: 'email',
                                                                        id: 'email',
                                                                        className: 'form-control',
                                                                        placeholder: 'Enter your email',
                                                                        required: true,
                                                                        disabled: isLoading
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            className: 'form-group',
                                                            children: [
                                                                {
                                                                    label: { 
                                                                        text: 'Password:',
                                                                        htmlFor: 'password'
                                                                    }
                                                                },
                                                                {
                                                                    input: {
                                                                        type: 'password',
                                                                        name: 'password',
                                                                        id: 'password',
                                                                        className: 'form-control',
                                                                        placeholder: 'Create a password',
                                                                        required: true,
                                                                        disabled: isLoading
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            className: 'form-group',
                                                            children: [
                                                                {
                                                                    label: { 
                                                                        text: 'Confirm Password:',
                                                                        htmlFor: 'confirmPassword'
                                                                    }
                                                                },
                                                                {
                                                                    input: {
                                                                        type: 'password',
                                                                        name: 'confirmPassword',
                                                                        id: 'confirmPassword',
                                                                        className: 'form-control',
                                                                        placeholder: 'Confirm your password',
                                                                        required: true,
                                                                        disabled: isLoading
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    },
                                                    {
                                                        div: {
                                                            children: [
                                                                {
                                                                    button: {
                                                                        type: 'submit',
                                                                        className: 'btn',
                                                                        disabled: isLoading,
                                                                        text: isLoading ? 'Creating Account...' : 'Register'
                                                                    }
                                                                },
                                                                {
                                                                    RouterLink: {
                                                                        to: '/login',
                                                                        className: 'btn btn-secondary',
                                                                        text: 'Login Instead'
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    ].filter(Boolean);
                                }
                            }
                        }
                    ]
                }
            }),

            // Profile Page Component
            ProfilePage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: () => {
                        const user = context.getState('auth.user', null);
                        const isAuthenticated = context.getState('auth.isAuthenticated', false);
                        
                        if (!isAuthenticated || !user) {
                            return [
                                {
                                    div: {
                                        className: 'protected-route-notice',
                                        text: 'Please log in to view your profile.'
                                    }
                                },
                                {
                                    RouterLink: {
                                        to: '/login',
                                        className: 'btn',
                                        text: 'Go to Login'
                                    }
                                }
                            ];
                        }
                        
                        return [
                            {
                                h1: {
                                    className: 'page-title',
                                    text: `üë§ Welcome, ${user.name}!`
                                }
                            },
                            {
                                p: {
                                    className: 'page-subtitle',
                                    text: 'Your profile information and account details.'
                                }
                            },
                            {
                                div: {
                                    className: 'demo-section',
                                    children: [
                                        {
                                            h3: { text: 'Account Information' }
                                        },
                                        {
                                            div: {
                                                className: 'param-display',
                                                text: JSON.stringify(user, null, 2)
                                            }
                                        }
                                    ]
                                }
                            },
                            {
                                div: {
                                    className: 'demo-section',
                                    children: [
                                        {
                                            h3: { text: 'Account Actions' }
                                        },
                                        {
                                            div: {
                                                children: [
                                                    {
                                                        button: {
                                                            className: 'btn',
                                                            text: 'Update Profile',
                                                            onClick: () => {
                                                                alert('Profile update functionality would be implemented here.');
                                                            }
                                                        }
                                                    },
                                                    {
                                                        button: {
                                                            className: 'btn btn-secondary',
                                                            text: 'Change Password',
                                                            onClick: () => {
                                                                alert('Change password functionality would be implemented here.');
                                                            }
                                                        }
                                                    },
                                                    {
                                                        button: {
                                                            className: 'btn btn-secondary',
                                                            text: 'Logout',
                                                            onClick: () => {
                                                                authService.logout();
                                                                context.navigate('/');
                                                            }
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ];
                    }
                }
            }),

            // Home Page Component
            HomePage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: [
                        {
                            h1: {
                                className: 'page-title',
                                text: 'üöÄ Welcome to Juris Router Demo'
                            }
                        },
                        {
                            p: {
                                className: 'page-subtitle',
                                text: 'This demo showcases all the advanced routing features implemented in Juris.'
                            }
                        },
                        {
                            div: {
                                className: 'demo-section',
                                children: [
                                    {
                                        h3: { text: '‚ú® Features Demonstrated' }
                                    },
                                    {
                                        ul: {
                                            children: [
                                                { li: { text: 'Hash-based and History API routing' } },
                                                { li: { text: 'Parameter extraction and validation' } },
                                                { li: { text: 'Query string parsing and handling' } },
                                                { li: { text: 'Route guards and middleware' } },
                                                { li: { text: 'Lazy loading (simulated)' } },
                                                { li: { text: 'Nested routing with RouterOutlet' } },
                                                { li: { text: 'RouterLink with active states' } },
                                                { li: { text: 'Error handling and 404 pages' } },
                                                { li: { text: 'Route transitions' } }
                                            ]
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            div: {
                                className: 'demo-section',
                                children: [
                                    {
                                        h3: { text: 'üß™ Try These Routes' }
                                    },
                                    {
                                        p: { text: 'Click these buttons to test different routing scenarios:' }
                                    },
                                    {
                                        div: {
                                            children: [
                                                {
                                                    button: {
                                                        className: 'btn',
                                                        text: 'User Profile (/users/123)',
                                                        onClick: () => context.navigate('/users/123')
                                                    }
                                                },
                                                {
                                                    button: {
                                                        className: 'btn',
                                                        text: 'Search with Query (/search?q=test)',
                                                        onClick: () => context.navigate('/search?q=test&page=2&sort=name')
                                                    }
                                                },
                                                {
                                                    button: {
                                                        className: 'btn',
                                                        text: 'Optional Param (/products)',
                                                        onClick: () => context.navigate('/products')
                                                    }
                                                },
                                                {
                                                    button: {
                                                        className: 'btn btn-secondary',
                                                        text: 'Test 404 (/nonexistent)',
                                                        onClick: () => context.navigate('/nonexistent')
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            }),

            // About Page Component
            AboutPage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: [
                        {
                            h1: {
                                className: 'page-title',
                                text: 'üìñ About Juris Router'
                            }
                        },
                        {
                            p: {
                                className: 'page-subtitle',
                                text: 'Advanced routing capabilities for modern web applications.'
                            }
                        },
                        {
                            div: {
                                className: 'demo-section',
                                children: [
                                    {
                                        h3: { text: 'Route Configuration' }
                                    },
                                    {
                                        pre: {
                                            className: 'param-display',
                                            text: `routes: {
  '/': 'HomePage',
  '/about': 'AboutPage',
  '/users/:id': {
    component: 'UserPage',
    params: {
      id: { type: 'number', required: true }
    }
  },
  '/products/:category?': {
    component: 'ProductPage',
    params: {
      category: { type: 'string', optional: true }
    }
  }
}`
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            }),

            // Users List Component
            UsersListPage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: [
                        {
                            h1: {
                                className: 'page-title',
                                text: 'üë• Users Directory'
                            }
                        },
                        {
                            p: {
                                className: 'page-subtitle',
                                text: 'Click on any user to view their profile with URL parameters.'
                            }
                        },
                        {
                            div: {
                                className: 'demo-section',
                                children: [
                                    {
                                        h3: { text: 'User List' }
                                    },
                                    {
                                        div: {
                                            children: () => {
                                                const users = [
                                                    { id: 1, name: 'Alice Johnson', role: 'Admin' },
                                                    { id: 2, name: 'Bob Smith', role: 'User' },
                                                    { id: 3, name: 'Carol Williams', role: 'Moderator' },
                                                    { id: 123, name: 'Demo User', role: 'Demo' }
                                                ];

                                                return users.map(user => ({
                                                    div: {
                                                        style: {
                                                            padding: '1rem',
                                                            margin: '0.5rem 0',
                                                            background: 'white',
                                                            borderRadius: '6px',
                                                            border: '1px solid #ddd'
                                                        },
                                                        children: [
                                                            {
                                                                h4: { text: user.name }
                                                            },
                                                            {
                                                                p: { text: `Role: ${user.role}` }
                                                            },
                                                            {
                                                                RouterLink: {
                                                                    to: `/users/${user.id}`,
                                                                    className: 'btn',
                                                                    text: 'View Profile'
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }));
                                            }
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            }),

            // User Profile Component
            UserPage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: () => {
                        const userId = context.getState('router.params.id');
                        const routeParams = context.getState('router.params', {});
                        const routeQuery = context.getState('router.query', {});
                        
                        return [
                            {
                                h1: {
                                    className: 'page-title',
                                    text: `üë§ User Profile #${userId}`
                                }
                            },
                            {
                                p: {
                                    className: 'page-subtitle',
                                    text: 'This page demonstrates parameter extraction and validation.'
                                }
                            },
                            {
                                div: {
                                    className: 'demo-section',
                                    children: [
                                        {
                                            h3: { text: 'Route Parameters' }
                                        },
                                        {
                                            div: {
                                                className: 'param-display',
                                                text: JSON.stringify(routeParams, null, 2)
                                            }
                                        }
                                    ]
                                }
                            },
                            {
                                div: {
                                    className: 'demo-section',
                                    children: [
                                        {
                                            h3: { text: 'Query Parameters' }
                                        },
                                        {
                                            div: {
                                                className: 'param-display',
                                                text: JSON.stringify(routeQuery, null, 2)
                                            }
                                        }
                                    ]
                                }
                            },
                            {
                                div: {
                                    children: [
                                        {
                                            RouterLink: {
                                                to: '/users',
                                                className: 'btn btn-secondary',
                                                text: '‚Üê Back to Users'
                                            }
                                        },
                                        {
                                            button: {
                                                className: 'btn',
                                                text: 'Add Query Param',
                                                onClick: () => {
                                                    context.navigate(`/users/${userId}?tab=profile&timestamp=${Date.now()}`);
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        ];
                    }
                }
            }),

            // Products Page Component
            ProductPage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: () => {
                        const category = context.getState('router.params.category');
                        const routeParams = context.getState('router.params', {});
                        
                        return [
                            {
                                h1: {
                                    className: 'page-title',
                                    text: category ? `üì± ${category.charAt(0).toUpperCase() + category.slice(1)} Products` : 'üõçÔ∏è All Products'
                                }
                            },
                            {
                                p: {
                                    className: 'page-subtitle',
                                    text: 'This page demonstrates optional parameters in routes.'
                                }
                            },
                            {
                                div: {
                                    className: 'demo-section',
                                    children: [
                                        {
                                            h3: { text: 'Current Category' }
                                        },
                                        {
                                            div: {
                                                className: 'param-display',
                                                text: category || 'No category (showing all products)'
                                            }
                                        },
                                        {
                                            h3: { text: 'Route Parameters' }
                                        },
                                        {
                                            div: {
                                                className: 'param-display',
                                                text: JSON.stringify(routeParams, null, 2)
                                            }
                                        }
                                    ]
                                }
                            },
                            {
                                div: {
                                    children: [
                                        {
                                            h3: { text: 'Try Different Categories' }
                                        },
                                        {
                                            div: {
                                                children: [
                                                    {
                                                        RouterLink: {
                                                            to: '/products',
                                                            className: 'btn',
                                                            text: 'All Products'
                                                        }
                                                    },
                                                    {
                                                        RouterLink: {
                                                            to: '/products/electronics',
                                                            className: 'btn',
                                                            text: 'Electronics'
                                                        }
                                                    },
                                                    {
                                                        RouterLink: {
                                                            to: '/products/books',
                                                            className: 'btn',
                                                            text: 'Books'
                                                        }
                                                    },
                                                    {
                                                        RouterLink: {
                                                            to: '/products/clothing',
                                                            className: 'btn',
                                                            text: 'Clothing'
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ];
                    }
                }
            }),

            // Search Page Component
            SearchPage: (props, context) => ({
                div: {
                    className: 'page-content',
                    children: () => {
                        const query = context.getState('router.query', {});
                        const searchTerm = query.q || '';
                        const page = query.page || 1;
                        const sort = query.sort || 'relevance';
                        
                        return [
                            {
                                h1: {
                                    className: 'page-title',
                                    text: 'üîç Search Results'
                                }
                            },
                            {
                                p: {
                                    className: 'page-subtitle',
                                    text: 'This page demonstrates advanced query parameter handling.'
                                }
                            },
                            {
                                div: {
                                    className: 'demo-section',
                                    children: [
                                        {
                                            h3: { text: 'Search Parameters' }
                                        },
                                        {
                                            div: {
                                                className: 'param-display',
                                                text: JSON.stringify(query, null, 2)
                                            }
                                        }
                                    ]
                                }
                            },
                            {
                                div: {
                                    className: 'demo-section',
                                    children: [
                                        {
                                            h3: { text: 'Update Search' }
                                        },
                                        {
                                            div: {
                                                className: 'form-group',
                                                children: [
                                                    {
                                                        label: { text: 'Search Term:' }
                                                    },
                                                    {
                                                        input: {
                                                            type: 'text',
                                                            className: 'form-control',
                                                            value: searchTerm,
                                                            id: 'searchInput'
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            div: {
                                                children: [
                                                    {
                                                        button: {
                                                            className: 'btn',
                                                            text: 'Search',
                                                            onClick: () => {
                                                                const input = document.getElementById('searchInput');
                                                                const newQuery = input.value;
                                                                context.navigate(`/search?q=${encodeURIComponent(newQuery)}&page=1&sort=${sort}`);
                                                            }
                                                        }
                                                    },
                                                    {
                                                        button: {
                                                            className: 'btn',
                                                            text: 'Sort by Date',
                                                            onClick: () => {
                                                                context.navigate(`/search?q=${encodeURIComponent(searchTerm)}&page=${page}&sort=date`);
                                                            }
                                                        }
                                                    },
                                                    {
                                                        button: {
                                                            className: 'btn',
                                                            text: 'Next Page',
                                                            onClick: () => {
                                                                context.navigate(`/search?q=${encodeURIComponent(searchTerm)}&page=${parseInt(page) + 1}&sort=${sort}`);
                                                            }
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ];
                    }
                }
            }),

            // Admin Layout Component
            AdminPage: (props, context) => ({
                div: {
                    children: () => {
                        const isAuthenticated = context.getState('auth.isAuthenticated', false);
                        const user = context.getState('auth.user', null);
                        
                        if (!isAuthenticated) {
                            return [
                                {
                                    div: {
                                        className: 'page-content',
                                        children: [
                                            {
                                                div: {
                                                    className: 'protected-route-notice',
                                                    children: [
                                                        {
                                                            h3: { text: 'üîí Authentication Required' }
                                                        },
                                                        {
                                                            p: { text: 'You must be logged in to access the admin area.' }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                div: {
                                                    children: [
                                                        {
                                                            RouterLink: {
                                                                to: `/login?returnUrl=${encodeURIComponent(context.getState('router.currentRoute'))}`,
                                                                className: 'btn',
                                                                text: 'Login to Continue'
                                                            }
                                                        },
                                                        {
                                                            RouterLink: {
                                                                to: '/',
                                                                className: 'btn btn-secondary',
                                                                text: 'Go Home'
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                }
                            ];
                        }
                        
                        if (user && user.role !== 'admin') {
                            return [
                                {
                                    div: {
                                        className: 'page-content',
                                        children: [
                                            {
                                                div: {
                                                    className: 'error-message',
                                                    children: [
                                                        {
                                                            h3: { text: '‚ùå Access Denied' }
                                                        },
                                                        {
                                                            p: { text: 'You do not have permission to access the admin area.' }
                                                        },
                                                        {
                                                            p: { text: `Current role: ${user.role}. Required role: admin.` }
                                                        }
                                                    ]
                                                }
                                            },
                                            {
                                                RouterLink: {
                                                    to: '/',
                                                    className: 'btn',
                                                    text: 'Go Home'
                                                }
                                            }
                                        ]
                                    }
                                }
                            ];
                        }
                        
                        return [
                            {
                                div: {
                                    className: 'admin-layout',
                                    children: [
                                        {
                                            div: {
                                                className: 'admin-sidebar',
                                                children: [
                                                    {
                                                        h3: { text: '‚öôÔ∏è Admin Panel' }
                                                    },
                                                    {
                                                        p: { 
                                                            text: `Welcome, ${user.name}`,
                                                            style: { opacity: '0.8', marginBottom: '1rem' }
                                                        }
                                                    },
                                                    {
                                                        nav: {
                                                            children: [
                                                                {
                                                                    RouterLink: {
                                                                        to: '/admin/dashboard',
                                                                        text: 'üìä Dashboard',
                                                                        style: { display: 'block', color: 'white', padding: '0.5rem 0' }
                                                                    }
                                                                },
                                                                {
                                                                    RouterLink: {
                                                                        to: '/admin/users',
                                                                        text: 'üë• Manage Users',
                                                                        style: { display: 'block', color: 'white', padding: '0.5rem 0' }
                                                                    }
                                                                },
                                                                {
                                                                    RouterLink: {
                                                                        to: '/admin/settings',
                                                                        text: '‚öôÔ∏è Settings',
                                                                        style: { display: 'block', color: 'white', padding: '0.5rem 0' }
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            div: {
                                                className: 'admin-content',
                                                children: [
                                                    {
                                                        div: {
                                                            className: 'page-content',
                                                            children: [
                                                                {
                                                                    h1: { text: '‚öôÔ∏è Admin Dashboard' }
                                                                },
                                                                {
                                                                    p: { text: 'Welcome to the admin area. This demonstrates protected routes with role-based access.' }
                                                                },
                                                                {
                                                                    div: {
                                                                        className: 'demo-section',
                                                                        children: [
                                                                            {
                                                                                h3: { text: 'Admin Features' }
                                                                            },
                                                                            {
                                                                                ul: {
                                                                                    children: [
                                                                                        { li: { text: 'User Management' } },
                                                                                        { li: { text: 'System Settings' } },
                                                                                        { li: { text: 'Analytics Dashboard' } },
                                                                                        { li: { text: 'Content Management' } }
                                                                                    ]
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    }
                                                ]
                                            }
                                        }
                                    ]
                                }
                            }
                        ];
                    }
                }
            }),

            // 404 Not Found Component
            NotFoundPage: (props, context) => ({
                div: {
                    className: 'router-not-found',
                    children: [
                        {
                            h1: {
                                style: { fontSize: '4rem', marginBottom: '1rem' },
                                text: '404'
                            }
                        },
                        {
                            h2: { text: 'Page Not Found' }
                        },
                        {
                            p: {
                                text: () => `The route "${context.getState('router.currentRoute')}" does not exist.`
                            }
                        },
                        {
                            RouterLink: {
                                to: '/',
                                className: 'btn',
                                text: 'üè† Go Home'
                            }
                        }
                    ]
                }
            }),

            // Loading Component
            LoadingPage: (props, context) => ({
                div: {
                    className: 'router-loading',
                    children: [
                        {
                            div: { className: 'loading-spinner' }
                        },
                        {
                            p: { text: 'Loading...' }
                        }
                    ]
                }
            })
        };

        // Authentication Service
        const authService = {
            // Demo users database
            users: [
                { id: 1, username: 'admin', password: 'password', name: 'Admin User', email: 'admin@demo.com', role: 'admin' },
                { id: 2, username: 'user', password: 'password', name: 'Regular User', email: 'user@demo.com', role: 'user' },
                { id: 3, username: 'demo', password: 'password', name: 'Demo User', email: 'demo@demo.com', role: 'user' }
            ],

            // Login method
            async login(username, password) {
                app.setState('auth.isLoading', true);
                app.setState('auth.error', null);

                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                const user = this.users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    const userSession = {
                        id: user.id,
                        username: user.username,
                        name: user.name,
                        email: user.email,
                        role: user.role,
                        loginTime: new Date().toISOString()
                    };

                    app.setState('auth.user', userSession);
                    app.setState('auth.isAuthenticated', true);
                    app.setState('auth.isLoading', false);
                    app.setState('auth.error', null);

                    // Store in localStorage for persistence
                    localStorage.setItem('juris_auth', JSON.stringify(userSession));

                    console.log('‚úÖ Login successful:', userSession);
                    return userSession;
                } else {
                    const error = 'Invalid username or password';
                    app.setState('auth.error', error);
                    app.setState('auth.isLoading', false);
                    console.log('‚ùå Login failed:', error);
                    throw new Error(error);
                }
            },

            // Register method
            async register(userData) {
                app.setState('auth.isLoading', true);
                app.setState('auth.error', null);

                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Validate data
                if (userData.password !== userData.confirmPassword) {
                    const error = 'Passwords do not match';
                    app.setState('auth.error', error);
                    app.setState('auth.isLoading', false);
                    throw new Error(error);
                }

                if (this.users.find(u => u.username === userData.username)) {
                    const error = 'Username already exists';
                    app.setState('auth.error', error);
                    app.setState('auth.isLoading', false);
                    throw new Error(error);
                }

                // Create new user
                const newUser = {
                    id: this.users.length + 1,
                    username: userData.username,
                    password: userData.password,
                    name: userData.username,
                    email: userData.email,
                    role: 'user'
                };

                this.users.push(newUser);

                // Auto-login after registration
                const userSession = {
                    id: newUser.id,
                    username: newUser.username,
                    name: newUser.name,
                    email: newUser.email,
                    role: newUser.role,
                    loginTime: new Date().toISOString()
                };

                app.setState('auth.user', userSession);
                app.setState('auth.isAuthenticated', true);
                app.setState('auth.isLoading', false);
                app.setState('auth.error', null);

                localStorage.setItem('juris_auth', JSON.stringify(userSession));

                console.log('‚úÖ Registration successful:', userSession);
                return userSession;
            },

            // Logout method
            logout() {
                app.setState('auth.user', null);
                app.setState('auth.isAuthenticated', false);
                app.setState('auth.error', null);
                app.setState('auth.isLoading', false);

                localStorage.removeItem('juris_auth');
                console.log('‚úÖ Logout successful');
            },

            // Check existing session
            checkAuth() {
                try {
                    const stored = localStorage.getItem('juris_auth');
                    if (stored) {
                        const userSession = JSON.parse(stored);
                        app.setState('auth.user', userSession);
                        app.setState('auth.isAuthenticated', true);
                        console.log('‚úÖ Session restored:', userSession);
                        return userSession;
                    }
                } catch (error) {
                    console.error('Failed to restore session:', error);
                    this.logout();
                }
                return null;
            }
        };

        // Route Guards
        const guards = {
            authGuard: async (context) => {
                console.log('üõ°Ô∏è Running auth guard for:', context.route);
                
                const isAuthenticated = app.getState('auth.isAuthenticated', false);
                
                if (!isAuthenticated) {
                    alert('You must be logged in to access this page.');
                    context.navigate(`/login?returnUrl=${encodeURIComponent(context.route)}`);
                    return false;
                }
                
                return true;
            },

            adminGuard: async (context) => {
                console.log('üõ°Ô∏è Running admin guard for:', context.route);
                
                const isAuthenticated = app.getState('auth.isAuthenticated', false);
                const user = app.getState('auth.user', null);
                
                if (!isAuthenticated) {
                    alert('You must be logged in to access the admin area.');
                    context.navigate(`/login?returnUrl=${encodeURIComponent(context.route)}`);
                    return false;
                }
                
                if (user && user.role !== 'admin') {
                    alert('You do not have permission to access the admin area.');
                    context.navigate('/');
                    return false;
                }
                
                return true;
            },

            guestGuard: async (context) => {
                console.log('üõ°Ô∏è Running guest guard for:', context.route);
                
                const isAuthenticated = app.getState('auth.isAuthenticated', false);
                
                if (isAuthenticated) {
                    // Redirect authenticated users away from login/register pages
                    context.navigate('/profile');
                    return false;
                }
                
                return true;
            }
        };

        // Initialize Juris with Router Configuration
        const app = new Juris({
            // State
            states: {
                app: {
                    name: 'Juris Router Demo',
                    version: '1.0.0'
                },
                auth: {
                    isAuthenticated: false,
                    user: null,
                    isLoading: false,
                    error: null
                }
            },

            // Components
            components,

            // Router Configuration
            router: {
                mode: 'hash', // You can change this to 'history' for HTML5 mode
                base: '',
                
                // Routes with advanced configurations
                routes: {
                    '/': {
                        component: 'HomePage',
                        meta: { title: 'Home - Juris Demo' }
                    },
                    
                    '/about': {
                        component: 'AboutPage',
                        meta: { title: 'About - Juris Demo' }
                    },

                    '/login': {
                        component: 'LoginPage',
                        guards: ['guestGuard'],
                        meta: { title: 'Login - Juris Demo' }
                    },

                    '/register': {
                        component: 'RegisterPage',
                        guards: ['guestGuard'],
                        meta: { title: 'Register - Juris Demo' }
                    },

                    '/profile': {
                        component: 'ProfilePage',
                        guards: ['authGuard'],
                        meta: { title: 'Profile - Juris Demo' }
                    },
                    
                    '/users': {
                        component: 'UsersListPage',
                        meta: { title: 'Users - Juris Demo' }
                    },
                    
                    '/users/:id': {
                        component: 'UserPage',
                        params: {
                            id: { 
                                type: 'number', 
                                required: true,
                                min: 1,
                                max: 9999
                            }
                        },
                        meta: { title: 'User Profile - Juris Demo' }
                    },
                    
                    '/products/:category?': {
                        component: 'ProductPage',
                        params: {
                            category: { 
                                type: 'string', 
                                optional: true,
                                enum: ['electronics', 'books', 'clothing', 'sports']
                            }
                        },
                        meta: { title: 'Products - Juris Demo' }
                    },
                    
                    '/search': {
                        component: 'SearchPage',
                        query: {
                            q: { type: 'string', required: true },
                            page: { type: 'number', default: 1, min: 1 },
                            sort: { type: 'string', default: 'relevance', enum: ['relevance', 'date', 'name'] }
                        },
                        meta: { title: 'Search - Juris Demo' }
                    },
                    
                    '/admin': {
                        component: 'AdminPage',
                        guards: ['authGuard', 'adminGuard'],
                        meta: { title: 'Admin - Juris Demo' }
                    },
                    
                    '/admin/*': {
                        component: 'AdminPage',
                        guards: ['authGuard', 'adminGuard'],
                        children: {
                            'dashboard': { component: 'AdminDashboard' },
                            'users': { component: 'AdminUsers' },
                            'settings': { component: 'AdminSettings' }
                        }
                    },
                    
                    // 404 route
                    '*': {
                        component: 'NotFoundPage'
                    }
                },
                
                // Route guards
                guards,
                
                // Global middleware
                middleware: [
                    {
                        path: '/*',
                        guard: async (context) => {
                            console.log('üîÑ Global middleware for:', context.route);
                            return true;
                        }
                    }
                ],
                
                // Transitions
                transitions: true,
                
                // Scroll behavior
                scrollBehavior: 'top'
            },

            // Layout
            layout: {
                div: {
                    className: 'demo-container',
                    children: [
                        {
                            div: {
                                className: 'demo-header',
                                children: [
                                    {
                                        h1: { text: 'üöÄ Juris Advanced Router Demo' }
                                    },
                                    {
                                        p: { text: 'Comprehensive demonstration of advanced routing features including parameter validation, query strings, guards, and more.' }
                                    }
                                ]
                            }
                        },
                        {
                            Navigation: {}
                        },
                        {
                            div: {
                                className: 'content-area',
                                children: [
                                    {
                                        Router: {
                                            loadingComponent: 'LoadingPage',
                                            errorComponent: 'ErrorPage',
                                            notFoundComponent: 'NotFoundPage'
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            }
        });

        // Update router info panel
        function updateRouterInfo() {
            const routerDetails = document.getElementById('routerDetails');
            if (routerDetails) {
                const currentRoute = app.getState('router.currentRoute', '/');
                const params = app.getState('router.params', {});
                const query = app.getState('router.query', {});
                const isLoading = app.getState('router.isLoading', false);
                const error = app.getState('router.error', null);
                
                routerDetails.innerHTML = `
                    <strong>Route:</strong> ${currentRoute}<br>
                    <strong>Params:</strong> ${JSON.stringify(params)}<br>
                    <strong>Query:</strong> ${JSON.stringify(query)}<br>
                    <strong>Loading:</strong> ${isLoading}<br>
                    <strong>Error:</strong> ${error || 'None'}<br>
                    <strong>Mode:</strong> ${app.router.mode}<br>
                    <strong>Components:</strong> ${app.components.size}
                `;
            }
        }

        // Update auth status panel
        function updateAuthStatus() {
            const authStatus = document.getElementById('authStatus');
            const authDetails = document.getElementById('authDetails');
            
            if (authStatus && authDetails) {
                const isAuthenticated = app.getState('auth.isAuthenticated', false);
                const user = app.getState('auth.user', null);
                const isLoading = app.getState('auth.isLoading', false);
                const error = app.getState('auth.error', null);
                
                authStatus.className = `auth-status ${isAuthenticated ? 'authenticated' : 'unauthenticated'}`;
                
                if (isLoading) {
                    authDetails.innerHTML = '‚è≥ Loading...';
                } else if (isAuthenticated && user) {
                    authDetails.innerHTML = `
                        <strong>üü¢ Authenticated</strong><br>
                        <strong>User:</strong> ${user.name}<br>
                        <strong>Role:</strong> ${user.role}<br>
                        <strong>ID:</strong> ${user.id}
                    `;
                } else {
                    authDetails.innerHTML = `
                        <strong>üî¥ Not Authenticated</strong><br>
                        <strong>Status:</strong> Guest<br>
                        ${error ? `<strong>Error:</strong> ${error}` : ''}
                    `;
                }
            }
        }

        // Subscribe to router state changes
        app.subscribe('router.currentRoute', updateRouterInfo);
        app.subscribe('router.params', updateRouterInfo);
        app.subscribe('router.query', updateRouterInfo);
        app.subscribe('router.isLoading', updateRouterInfo);
        app.subscribe('router.error', updateRouterInfo);

        // Subscribe to auth state changes
        app.subscribe('auth.isAuthenticated', updateAuthStatus);
        app.subscribe('auth.user', updateAuthStatus);
        app.subscribe('auth.isLoading', updateAuthStatus);
        app.subscribe('auth.error', updateAuthStatus);

        // Check for existing authentication on startup
        authService.checkAuth();

        // Initial render
        app.render();
        updateRouterInfo();
        updateAuthStatus();

        // Make app available globally for debugging
        window.app = app;
        window.authService = authService;
        
        console.log('üéâ Juris Router Demo with Authentication loaded!');
        console.log('üí° Access the app instance via window.app for debugging.');
        console.log('üîë Access the auth service via window.authService for debugging.');
        console.log('üß™ Try logging in with: admin/password, user/password, or demo/password');
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris Framework - Todo App with Headless Services</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .navigation {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .nav-button:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .nav-button.active {
            background: #007bff;
        }

        .route-info {
            background: #e3f2fd;
            padding: 10px 20px;
            font-size: 12px;
            color: #1976d2;
            border-bottom: 1px solid #bbdefb;
        }

        #app {
            padding: 30px;
        }

        .todo-form {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .todo-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.2s ease;
        }

        .todo-input:focus {
            outline: none;
            border-color: #007bff;
        }

        .add-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .add-button:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .filter-button:hover {
            background: #5a6268;
        }

        .filter-button.active {
            background: #007bff;
        }

        .clear-completed {
            background: #dc3545;
            margin-left: auto;
        }

        .clear-completed:hover {
            background: #c82333;
        }

        .clear-completed:disabled {
            background: #6c757d;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .todo-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s ease;
        }

        .todo-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .todo-item.completed {
            opacity: 0.7;
            background: #e9ecef;
        }

        .todo-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .todo-text {
            flex: 1;
            font-size: 16px;
            cursor: pointer;
        }

        .todo-text.completed {
            text-decoration: line-through;
            color: #6c757d;
        }

        .todo-actions {
            display: flex;
            gap: 8px;
        }

        .action-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .edit-button {
            background: #ffc107;
        }

        .delete-button {
            background: #dc3545;
        }

        .save-button {
            background: #28a745;
        }

        .cancel-button {
            background: #6c757d;
        }

        .action-button:hover {
            transform: translateY(-1px);
        }

        .todo-edit-input {
            flex: 1;
            padding: 8px;
            border: 2px solid #007bff;
            border-radius: 6px;
            font-size: 16px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .auth-form {
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .auth-form input {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
        }

        .auth-form button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        .unauthorized {
            text-align: center;
            padding: 60px 20px;
        }

        .service-status {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .service-status h4 {
            margin-bottom: 10px;
            color: #495057;
        }

        .service-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .service-indicator.active {
            background: #28a745;
        }

        .service-indicator.inactive {
            background: #dc3545;
        }
    </style>
</head>
<body>
    <h1>üìù Juris Todo App with Headless Services</h1>
    
    <div class="container">
        <div id="app"></div>
    </div>

    <script src="juris.js"></script>
    <script>        
        // Todo App using Headless Service Components instead of middleware
        const app = new Juris({
            states: {
                todos: [],
                filter: 'all',
                editingId: null,
                editText: '',
                newTodoText: '',
                user: {
                    isAuthenticated: false,
                    isAdmin: false,
                    username: '',
                    hasProfile: false
                },
                router: { 
                    currentRoute: '/',
                    isLoading: false,
                    hasUnsavedChanges: false,
                    error: null,
                    params: {}
                },
                services: {
                    logger: { enabled: true, logs: [] },
                    persistence: { enabled: true, lastSave: null },
                    crossTab: { enabled: true, lastSync: null },
                    analytics: { enabled: true, events: [] }
                }
            },
            
            router: {
                routes: {
                    '/': 'HomePage',
                    '/stats': 'StatsPage',
                    '/admin': 'AdminPage',
                    '/profile': 'ProfilePage',
                    '/login': 'LoginPage',
                    '/unauthorized': 'UnauthorizedPage'
                }
            },
            
            components: {
                // =================================================================
                // HEADLESS SERVICE COMPONENTS (using onRegistered hook)
                // =================================================================
                
                LoggerService: (props, context) => ({
                    onRegistered(props, context) {
                        console.log('üîÑ Logger service starting...');
                        
                        // Initialize logging state
                        context.setState('services.logger.startTime', Date.now());
                        context.setState('services.logger.enabled', true);
                        
                        // Subscribe to all state changes for logging
                        const unsubscribeAll = [];
                        
                        // Log todo changes
                        const unsubTodos = context.subscribe('todos', (newTodos, oldTodos) => {
                            if (context.getState('services.logger.enabled')) {
                                const log = {
                                    timestamp: Date.now(),
                                    type: 'STATE_CHANGE',
                                    path: 'todos',
                                    action: this.determineTodoAction(oldTodos, newTodos),
                                    count: newTodos ? newTodos.length : 0
                                };
                                this.addLog(log, context);
                                console.log(`üìù Todos ${log.action}: ${log.count} total`);
                            }
                        });
                        unsubscribeAll.push(unsubTodos);
                        
                        // Log route changes
                        const unsubRoute = context.subscribe('router.currentRoute', (newRoute) => {
                            if (context.getState('services.logger.enabled')) {
                                const log = {
                                    timestamp: Date.now(),
                                    type: 'ROUTE_CHANGE',
                                    route: newRoute
                                };
                                this.addLog(log, context);
                                console.log(`üõ£Ô∏è Route changed to: ${newRoute}`);
                            }
                        });
                        unsubscribeAll.push(unsubRoute);
                        
                        // Log auth changes
                        const unsubAuth = context.subscribe('user.isAuthenticated', (isAuth) => {
                            if (context.getState('services.logger.enabled')) {
                                const log = {
                                    timestamp: Date.now(),
                                    type: 'AUTH_CHANGE',
                                    authenticated: isAuth,
                                    username: context.getState('user.username', '')
                                };
                                this.addLog(log, context);
                                console.log(`üîê Authentication ${isAuth ? 'logged in' : 'logged out'}`);
                            }
                        });
                        unsubscribeAll.push(unsubAuth);
                        
                        console.log('‚úÖ Logger service started');
                        
                        // Return cleanup function
                        return () => {
                            console.log('üõë Logger service shutting down...');
                            unsubscribeAll.forEach(unsub => unsub());
                            context.setState('services.logger.enabled', false);
                            console.log('‚úÖ Logger service stopped');
                        };
                    },
                    
                    determineTodoAction(oldTodos, newTodos) {
                        if (!oldTodos) return 'initialized';
                        if (newTodos.length > oldTodos.length) return 'added';
                        if (newTodos.length < oldTodos.length) return 'removed';
                        return 'updated';
                    },
                    
                    addLog(log, context) {
                        const logs = context.getState('services.logger.logs', []);
                        const newLogs = [...logs.slice(-49), log]; // Keep last 50 logs
                        context.setState('services.logger.logs', newLogs);
                    }
                }),
                
                PersistenceService: (props, context) => ({
                    onRegistered(props, context) {
                        console.log('üîÑ Persistence service starting...');
                        
                        // Initialize persistence state
                        context.setState('services.persistence.enabled', true);
                        context.setState('services.persistence.lastSave', null);
                        
                        // Define which paths to persist
                        const persistPaths = ['todos', 'user', 'filter'];
                        const unsubscribeAll = [];
                        
                        // Subscribe to each persist path
                        persistPaths.forEach(path => {
                            const unsub = context.subscribe(path, (newValue) => {
                                if (context.getState('services.persistence.enabled')) {
                                    this.saveToPersistence(path, newValue, context);
                                }
                            });
                            unsubscribeAll.push(unsub);
                        });
                        
                        // Restore data on startup
                        this.restoreFromPersistence(persistPaths, context);
                        
                        console.log('‚úÖ Persistence service started');
                        
                        return () => {
                            console.log('üõë Persistence service shutting down...');
                            unsubscribeAll.forEach(unsub => unsub());
                            context.setState('services.persistence.enabled', false);
                            console.log('‚úÖ Persistence service stopped');
                        };
                    },
                    
                    saveToPersistence(path, value, context) {
                        try {
                            if (typeof Storage !== 'undefined') {
                                localStorage.setItem(`juris_${path}`, JSON.stringify(value));
                                context.setState('services.persistence.lastSave', Date.now());
                                console.log(`üíæ Saved ${path} to localStorage`);
                            }
                        } catch (error) {
                            console.error(`‚ùå Failed to save ${path}:`, error);
                        }
                    },
                    
                    restoreFromPersistence(paths, context) {
                        paths.forEach(path => {
                            try {
                                if (typeof Storage !== 'undefined') {
                                    const stored = localStorage.getItem(`juris_${path}`);
                                    if (stored) {
                                        const value = JSON.parse(stored);
                                        context.setState(path, value);
                                        console.log(`üîÑ Restored ${path} from localStorage`);
                                    }
                                }
                            } catch (error) {
                                console.error(`‚ùå Failed to restore ${path}:`, error);
                            }
                        });
                    }
                }),
                
                CrossTabSyncService: (props, context) => ({
                    onRegistered(props, context) {
                        console.log('üîÑ Cross-tab sync service starting...');
                        
                        // Initialize cross-tab sync state
                        context.setState('services.crossTab.enabled', true);
                        context.setState('services.crossTab.lastSync', null);
                        
                        // Listen for storage events from other tabs
                        const handleStorageEvent = (e) => {
                            if (e.key && e.key.startsWith('juris_') && e.newValue !== null) {
                                try {
                                    const path = e.key.replace('juris_', '');
                                    const newValue = JSON.parse(e.newValue);
                                    const currentValue = context.getState(path);
                                    
                                    // Only update if value actually changed
                                    if (JSON.stringify(currentValue) !== JSON.stringify(newValue)) {
                                        console.log(`üîÑ Cross-tab sync: ${path}`, newValue);
                                        context.setState(path, newValue);
                                        context.setState('services.crossTab.lastSync', Date.now());
                                        this.showSyncNotification(path);
                                    }
                                } catch (error) {
                                    console.error('Cross-tab sync error:', error);
                                }
                            }
                        };
                        
                        window.addEventListener('storage', handleStorageEvent);
                        
                        console.log('‚úÖ Cross-tab sync service started');
                        
                        return () => {
                            console.log('üõë Cross-tab sync service shutting down...');
                            window.removeEventListener('storage', handleStorageEvent);
                            context.setState('services.crossTab.enabled', false);
                            console.log('‚úÖ Cross-tab sync service stopped');
                        };
                    },
                    
                    showSyncNotification(path) {
                        let notification = document.getElementById('cross-tab-notification');
                        if (!notification) {
                            notification = document.createElement('div');
                            notification.id = 'cross-tab-notification';
                            notification.style.cssText = `
                                position: fixed;
                                top: 20px;
                                right: 20px;
                                background: #2196F3;
                                color: white;
                                padding: 12px 20px;
                                border-radius: 8px;
                                font-size: 14px;
                                z-index: 10000;
                                opacity: 0;
                                transition: opacity 0.3s ease;
                                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                            `;
                            document.body.appendChild(notification);
                        }
                        
                        const pathDisplayName = {
                            todos: 'Todos',
                            user: 'User data',
                            filter: 'Filter'
                        }[path] || path;
                        
                        notification.textContent = `üì± ${pathDisplayName} updated in another tab`;
                        notification.style.opacity = '1';
                        
                        setTimeout(() => {
                            notification.style.opacity = '0';
                            setTimeout(() => {
                                if (notification.parentNode) {
                                    notification.parentNode.removeChild(notification);
                                }
                            }, 300);
                        }, 3000);
                    }
                }),
                
                AnalyticsService: (props, context) => ({
                    onRegistered(props, context) {
                        console.log('üîÑ Analytics service starting...');
                        
                        // Initialize analytics state
                        context.setState('services.analytics.enabled', true);
                        context.setState('services.analytics.sessionStart', Date.now());
                        
                        const unsubscribeAll = [];
                        
                        // Track todo events
                        const unsubTodos = context.subscribe('todos', (newTodos, oldTodos) => {
                            if (context.getState('services.analytics.enabled')) {
                                this.trackEvent('todo_change', {
                                    count: newTodos ? newTodos.length : 0,
                                    completed: newTodos ? newTodos.filter(t => t.completed).length : 0
                                }, context);
                            }
                        });
                        unsubscribeAll.push(unsubTodos);
                        
                        // Track route changes
                        const unsubRoute = context.subscribe('router.currentRoute', (newRoute) => {
                            if (context.getState('services.analytics.enabled')) {
                                this.trackEvent('page_view', {
                                    route: newRoute,
                                    timestamp: Date.now()
                                }, context);
                            }
                        });
                        unsubscribeAll.push(unsubRoute);
                        
                        // Track session start
                        this.trackEvent('session_start', {
                            userAgent: navigator.userAgent,
                            timestamp: Date.now()
                        }, context);
                        
                        console.log('‚úÖ Analytics service started');
                        
                        return () => {
                            console.log('üõë Analytics service shutting down...');
                            
                            // Track session end
                            this.trackEvent('session_end', {
                                duration: Date.now() - context.getState('services.analytics.sessionStart', Date.now()),
                                timestamp: Date.now()
                            }, context);
                            
                            unsubscribeAll.forEach(unsub => unsub());
                            context.setState('services.analytics.enabled', false);
                            console.log('‚úÖ Analytics service stopped');
                        };
                    },
                    
                    trackEvent(eventName, data, context) {
                        const event = {
                            id: Date.now() + Math.random(),
                            name: eventName,
                            data,
                            timestamp: Date.now()
                        };
                        
                        const events = context.getState('services.analytics.events', []);
                        const newEvents = [...events.slice(-99), event]; // Keep last 100 events
                        context.setState('services.analytics.events', newEvents);
                        
                        console.log(`üìä Analytics: ${eventName}`, data);
                    }
                }),
                
                // =================================================================
                // VISUAL COMPONENTS
                // =================================================================
                
                ServiceStatus: (props, { getState }) => ({
                    div: {
                        className: 'service-status',
                        children: () => [{
                            h4: { text: 'üîß Headless Services Status' }
                        }, {
                            div: {
                                children: () => [{
                                    div: {
                                        children: () => [{
                                            span: { 
                                                className: () => getState('services.logger.enabled') ? 'service-indicator active' : 'service-indicator inactive'
                                            }
                                        }, {
                                            span: { text: 'Logger Service' }
                                        }, {
                                            span: { 
                                                text: () => ` (${getState('services.logger.logs', []).length} logs)`,
                                                style: { color: '#666', fontSize: '12px' }
                                            }
                                        }]
                                    }
                                }, {
                                    div: {
                                        children: () => [{
                                            span: { 
                                                className: () => getState('services.persistence.enabled') ? 'service-indicator active' : 'service-indicator inactive'
                                            }
                                        }, {
                                            span: { text: 'Persistence Service' }
                                        }, {
                                            span: { 
                                                text: () => {
                                                    const lastSave = getState('services.persistence.lastSave');
                                                    return lastSave ? ` (last save: ${new Date(lastSave).toLocaleTimeString()})` : ' (no saves yet)';
                                                },
                                                style: { color: '#666', fontSize: '12px' }
                                            }
                                        }]
                                    }
                                }, {
                                    div: {
                                        children: () => [{
                                            span: { 
                                                className: () => getState('services.crossTab.enabled') ? 'service-indicator active' : 'service-indicator inactive'
                                            }
                                        }, {
                                            span: { text: 'Cross-Tab Sync Service' }
                                        }, {
                                            span: { 
                                                text: () => {
                                                    const lastSync = getState('services.crossTab.lastSync');
                                                    return lastSync ? ` (last sync: ${new Date(lastSync).toLocaleTimeString()})` : ' (no syncs yet)';
                                                },
                                                style: { color: '#666', fontSize: '12px' }
                                            }
                                        }]
                                    }
                                }, {
                                    div: {
                                        children: () => [{
                                            span: { 
                                                className: () => getState('services.analytics.enabled') ? 'service-indicator active' : 'service-indicator inactive'
                                            }
                                        }, {
                                            span: { text: 'Analytics Service' }
                                        }, {
                                            span: { 
                                                text: () => ` (${getState('services.analytics.events', []).length} events)`,
                                                style: { color: '#666', fontSize: '12px' }
                                            }
                                        }]
                                    }
                                }]
                            }
                        }]
                    }
                }),
                
                Navigation: (props, { getState, navigate }) => ({
                    div: {
                        className: 'navigation',
                        children: () => {
                            const isAuthenticated = getState('user.isAuthenticated', false);
                            const currentRoute = getState('router.currentRoute', '/');
                            
                            const navItems = [{
                                button: {
                                    text: 'Home',
                                    className: currentRoute === '/' ? 'nav-button active' : 'nav-button',
                                    onClick: () => navigate('/')
                                }
                            }];
                            
                            if (isAuthenticated) {
                                navItems.push({
                                    button: {
                                        text: 'Statistics',
                                        className: currentRoute === '/stats' ? 'nav-button active' : 'nav-button',
                                        onClick: () => navigate('/stats')
                                    }
                                });
                                
                                navItems.push({
                                    button: {
                                        text: 'Admin',
                                        className: currentRoute === '/admin' ? 'nav-button active' : 'nav-button',
                                        onClick: () => navigate('/admin')
                                    }
                                });
                                
                                navItems.push({
                                    button: {
                                        text: `Logout (${getState('user.username')})`,
                                        className: 'nav-button',
                                        onClick: (e, { setState, navigate }) => {
                                            setState('user.isAuthenticated', false);
                                            setState('user.username', '');
                                            setState('user.isAdmin', false);
                                            navigate('/');
                                        }
                                    }
                                });
                            } else {
                                navItems.push({
                                    button: {
                                        text: 'Login',
                                        className: currentRoute === '/login' ? 'nav-button active' : 'nav-button',
                                        onClick: () => navigate('/login')
                                    }
                                });
                            }
                            
                            return navItems;
                        }
                    }
                }),
                
                HomePage: (props, { getState, setState }) => ({
                    div: {
                        children: () => [{
                            div: {
                                className: 'route-info',
                                text: () => `Route: / | Headless Services Demo`
                            }
                        }, {
                            ServiceStatus: {}
                        }, {
                            TodoForm: {}
                        }, {
                            TodoStats: {}
                        }, {
                            TodoFilters: {}
                        }, {
                            TodoList: {}
                        }]
                    }
                }),
                
                StatsPage: (props, { getState }) => ({
                    div: {
                        children: () => [{
                            div: {
                                className: 'route-info',
                                text: 'Route: /stats | Analytics & Logging Data'
                            }
                        }, {
                            h2: { 
                                text: 'üìä Analytics Dashboard',
                                style: { textAlign: 'center', marginBottom: '20px' }
                            }
                        }, {
                            ServiceStatus: {}
                        }, {
                            TodoStats: {}
                        }, {
                            div: {
                                className: 'service-status',
                                children: () => [{
                                    h4: { text: 'üìà Analytics Events (Last 10)' }
                                }, {
                                    div: {
                                        children: () => {
                                            const events = getState('services.analytics.events', []);
                                            const lastEvents = events.slice(-10).reverse();
                                            
                                            if (lastEvents.length === 0) {
                                                return [{ p: { text: 'No analytics events yet' } }];
                                            }
                                            
                                            return lastEvents.map(event => ({
                                                div: {
                                                    style: { 
                                                        padding: '8px', 
                                                        borderBottom: '1px solid #eee',
                                                        fontSize: '12px'
                                                    },
                                                    text: `${new Date(event.timestamp).toLocaleTimeString()} - ${event.name}: ${JSON.stringify(event.data)}`
                                                }
                                            }));
                                        }
                                    }
                                }]
                            }
                        }, {
                            div: {
                                className: 'service-status',
                                children: () => [{
                                    h4: { text: 'üìù Logger Events (Last 10)' }
                                }, {
                                    div: {
                                        children: () => {
                                            const logs = getState('services.logger.logs', []);
                                            const lastLogs = logs.slice(-10).reverse();
                                            
                                            if (lastLogs.length === 0) {
                                                return [{ p: { text: 'No logs yet' } }];
                                            }
                                            
                                            return lastLogs.map(log => ({
                                                div: {
                                                    style: { 
                                                        padding: '8px', 
                                                        borderBottom: '1px solid #eee',
                                                        fontSize: '12px'
                                                    },
                                                    text: `${new Date(log.timestamp).toLocaleTimeString()} - ${log.type}: ${JSON.stringify(log)}`
                                                }
                                            }));
                                        }
                                    }
                                }]
                            }
                        }]
                    }
                }),
                
                AdminPage: (props, { getState }) => ({
                    div: {
                        children: () => {
                            const isAuth = getState('user.isAuthenticated', false);
                            if (!isAuth) {
                                return [{
                                    div: {
                                        className: 'unauthorized',
                                        children: () => [{
                                            h2: { text: 'üö´ Please log in to access admin area' }
                                        }]
                                    }
                                }];
                            }
                            
                            return [{
                                div: {
                                    className: 'route-info',
                                    text: 'Route: /admin | Service Management'
                                }
                            }, {
                                h2: { 
                                    text: 'üîê Admin Dashboard',
                                    style: { textAlign: 'center', marginBottom: '20px' }
                                }
                            }, {
                                ServiceStatus: {}
                            }, {
                                div: {
                                    className: 'service-status',
                                    children: () => [{
                                        h4: { text: 'üõ†Ô∏è Service Controls' }
                                    }, {
                                        button: {
                                            text: 'Clear All Logs',
                                            className: 'filter-button',
                                            onClick: (e, { setState }) => {
                                                setState('services.logger.logs', []);
                                                setState('services.analytics.events', []);
                                            }
                                        }
                                    }, {
                                        button: {
                                            text: 'Clear LocalStorage',
                                            className: 'filter-button',
                                            style: { marginLeft: '10px' },
                                            onClick: () => {
                                                ['todos', 'user', 'filter'].forEach(path => {
                                                    localStorage.removeItem(`juris_${path}`);
                                                });
                                                location.reload();
                                            }
                                        }
                                    }]
                                }
                            }];
                        }
                    }
                }),
                
                LoginPage: (props, { setState, navigate }) => ({
                    div: {
                        children: () => [{
                            h2: { 
                                text: 'üîê Login',
                                style: { textAlign: 'center', marginBottom: '20px' }
                            }
                        }, {
                            div: {
                                className: 'auth-form',
                                children: () => [{
                                    input: {
                                        type: 'text',
                                        placeholder: 'Username (try: admin or user)',
                                        id: 'username'
                                    }
                                }, {
                                    input: {
                                        type: 'password',
                                        placeholder: 'Password (any)',
                                        id: 'password'
                                    }
                                }, {
                                    button: {
                                        text: 'Login',
                                        onClick: () => {
                                            const username = document.getElementById('username').value;
                                            const password = document.getElementById('password').value;
                                            
                                            if (username && password) {
                                                setState('user.isAuthenticated', true);
                                                setState('user.username', username);
                                                setState('user.isAdmin', username === 'admin');
                                                navigate('/');
                                            } else {
                                                alert('Please enter username and password');
                                            }
                                        }
                                    }
                                }]
                            }
                        }]
                    }
                }),
                
                // Todo components (simplified versions)
                TodoForm: (props, { setState, getState }) => ({
                    div: {
                        className: 'todo-form',
                        children: () => [{
                            input: {
                                type: 'text',
                                className: 'todo-input',
                                placeholder: 'What needs to be done?',
                                value: () => getState('newTodoText', ''),
                                onInput: (e, { setState }) => {
                                    setState('newTodoText', e.target.value);
                                },
                                onKeyPress: (e, { setState, getState }) => {
                                    if (e.key === 'Enter') {
                                        const text = getState('newTodoText', '').trim();
                                        if (text) {
                                            const todos = getState('todos', []);
                                            const newTodo = {
                                                id: Date.now() + Math.random(),
                                                text: text,
                                                completed: false,
                                                createdAt: new Date().toISOString()
                                            };
                                            setState('todos', [...todos, newTodo]);
                                            setState('newTodoText', '');
                                        }
                                    }
                                }
                            }
                        }, {
                            button: {
                                className: 'add-button',
                                text: 'Add Todo',
                                onClick: (e, { setState, getState }) => {
                                    const text = getState('newTodoText', '').trim();
                                    if (text) {
                                        const todos = getState('todos', []);
                                        const newTodo = {
                                            id: Date.now() + Math.random(),
                                            text: text,
                                            completed: false,
                                            createdAt: new Date().toISOString()
                                        };
                                        setState('todos', [...todos, newTodo]);
                                        setState('newTodoText', '');
                                    }
                                }
                            }
                        }]
                    }
                }),
                
                TodoFilters: (props, { setState, getState }) => ({
                    div: {
                        className: 'filters',
                        children: () => [{
                            button: {
                                className: () => getState('filter') === 'all' ? 'filter-button active' : 'filter-button',
                                text: 'All',
                                onClick: () => setState('filter', 'all')
                            }
                        }, {
                            button: {
                                className: () => getState('filter') === 'active' ? 'filter-button active' : 'filter-button',
                                text: 'Active',
                                onClick: () => setState('filter', 'active')
                            }
                        }, {
                            button: {
                                className: () => getState('filter') === 'completed' ? 'filter-button active' : 'filter-button',
                                text: 'Completed',
                                onClick: () => setState('filter', 'completed')
                            }
                        }, {
                            button: {
                                className: 'clear-completed',
                                text: 'Clear Completed',
                                disabled: () => {
                                    const todos = getState('todos', []);
                                    return !todos.some(todo => todo.completed);
                                },
                                onClick: (e, { setState, getState }) => {
                                    const todos = getState('todos', []);
                                    const activeTodos = todos.filter(todo => !todo.completed);
                                    setState('todos', activeTodos);
                                }
                            }
                        }]
                    }
                }),
                
                TodoList: (props, { getState, setState }) => ({
                    div: {
                        children: () => {
                            const todos = getState('todos', []);
                            const filter = getState('filter', 'all');
                            
                            const filteredTodos = todos.filter(todo => {
                                if (filter === 'all') return true;
                                if (filter === 'active') return !todo.completed;
                                if (filter === 'completed') return todo.completed;
                                return true;
                            });
                            
                            if (filteredTodos.length === 0) {
                                return [{
                                    div: {
                                        className: 'empty-state',
                                        children: () => [{
                                            h3: { text: 'No todos yet' }
                                        }, {
                                            p: { text: 'Add your first todo above to get started.' }
                                        }]
                                    }
                                }];
                            }
                            
                            return filteredTodos.map(todo => ({
                                div: {
                                    className: todo.completed ? 'todo-item completed' : 'todo-item',
                                    children: () => [{
                                        input: {
                                            type: 'checkbox',
                                            className: 'todo-checkbox',
                                            checked: todo.completed,
                                            onChange: (e, { setState, getState }) => {
                                                const todos = getState('todos', []);
                                                const updatedTodos = todos.map(t => 
                                                    t.id === todo.id ? { ...t, completed: !t.completed } : t
                                                );
                                                setState('todos', updatedTodos);
                                            }
                                        }
                                    }, {
                                        span: {
                                            className: todo.completed ? 'todo-text completed' : 'todo-text',
                                            text: todo.text
                                        }
                                    }, {
                                        div: {
                                            className: 'todo-actions',
                                            children: () => [{
                                                button: {
                                                    className: 'action-button delete-button',
                                                    text: 'Delete',
                                                    onClick: (e, { setState, getState }) => {
                                                        const todos = getState('todos', []);
                                                        const filteredTodos = todos.filter(t => t.id !== todo.id);
                                                        setState('todos', filteredTodos);
                                                    }
                                                }
                                            }]
                                        }
                                    }]
                                }
                            }));
                        }
                    }
                }),
                
                TodoStats: (props, { getState }) => ({
                    div: {
                        className: 'stats',
                        children: () => {
                            const todos = getState('todos', []);
                            const totalCount = todos.length;
                            const activeCount = todos.filter(todo => !todo.completed).length;
                            const completedCount = todos.filter(todo => todo.completed).length;
                            const completionRate = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
                            
                            return [{
                                div: {
                                    className: 'stat-item',
                                    children: () => [{
                                        div: { 
                                            className: 'stat-number', 
                                            text: totalCount.toString()
                                        }
                                    }, {
                                        div: { className: 'stat-label', text: 'Total' }
                                    }]
                                }
                            }, {
                                div: {
                                    className: 'stat-item',
                                    children: () => [{
                                        div: { 
                                            className: 'stat-number', 
                                            text: activeCount.toString()
                                        }
                                    }, {
                                        div: { className: 'stat-label', text: 'Active' }
                                    }]
                                }
                            }, {
                                div: {
                                    className: 'stat-item',
                                    children: () => [{
                                        div: { 
                                            className: 'stat-number', 
                                            text: completedCount.toString()
                                        }
                                    }, {
                                        div: { className: 'stat-label', text: 'Completed' }
                                    }]
                                }
                            }, {
                                div: {
                                    className: 'stat-item',
                                    children: () => [{
                                        div: { 
                                            className: 'stat-number', 
                                            text: `${completionRate}%`
                                        }
                                    }, {
                                        div: { className: 'stat-label', text: 'Complete' }
                                    }]
                                }
                            }];
                        }
                    }
                })
            },
            
            layout: {
                div: {
                    children: () => [{
                        Navigation: {}
                    }, {
                        Router: {}
                    }]
                }
            }
        });
        
        // Load initial todos if none exist
        if (app.getState('todos', []).length === 0) {
            const initialTodos = [
                { id: 1, text: 'Learn Juris Framework', completed: true, createdAt: new Date().toISOString() },
                { id: 2, text: 'Build a todo app with headless services', completed: false, createdAt: new Date().toISOString() },
                { id: 3, text: 'Test cross-tab synchronization', completed: false, createdAt: new Date().toISOString() }
            ];
            app.setState('todos', initialTodos);
        }
        
        // Initial render
        app.render('#app');
        
        // Expose app for debugging
        window.app = app;
        
        // Demo commands
        console.log('üéØ Headless Services Demo Commands:');
        console.log('app.getHeadlessComponents() - List all headless services');
        console.log('app.getState("services") - View service states');
        console.log('üí° Open multiple tabs to test cross-tab synchronization!');
        console.log('üí° Check /stats to see analytics and logging data');
        console.log('üí° Login as "admin" to access service controls');
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juris Component Composition Test Suite</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding: 30px;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .test-section:hover {
            border-color: #2196F3;
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.15);
        }
        
        .test-section h3 {
            margin: 0 0 20px 0;
            color: #2196F3;
            font-size: 1.4rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .test-component {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .test-component h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 1rem;
        }
        
        .counter {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }
        
        .counter button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        .counter button:hover {
            background: #1976D2;
        }
        
        .counter button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .counter span {
            font-weight: bold;
            font-size: 1.2rem;
            color: #2196F3;
            min-width: 30px;
            text-align: center;
        }
        
        .user-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #fafafa;
            transition: transform 0.2s;
        }
        
        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .user-card.active {
            border-color: #2196F3;
            background: #e3f2fd;
        }
        
        .user-card h5 {
            margin: 0 0 8px 0;
            color: #333;
        }
        
        .user-card p {
            margin: 4px 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .filter-controls input,
        .filter-controls select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .filter-controls label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: #555;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online { background: #4CAF50; }
        .status-offline { background: #F44336; }
        .status-away { background: #FF9800; }
        
        .theme-toggle {
            background: #FF9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin: 10px 0;
            transition: background 0.2s;
        }
        
        .theme-toggle:hover {
            background: #F57C00;
        }
        
        .dark-theme {
            background: #2d2d2d;
            color: #f0f0f0;
        }
        
        .dark-theme .test-section {
            background: #3d3d3d;
            border-color: #555;
        }
        
        .dark-theme .test-component {
            background: #4d4d4d;
            border-color: #666;
        }
        
        .performance-stats {
            background: #e8f5e8;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .performance-stats h5 {
            margin: 0 0 10px 0;
            color: #2e7d32;
        }
        
        .performance-stats div {
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        .error-boundary {
            border: 2px dashed #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #ffebee;
        }
        
        .error-boundary h5 {
            color: #d32f2f;
            margin: 0 0 10px 0;
        }
        
        .tab-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .tab-headers {
            display: flex;
            background: #f5f5f5;
        }
        
        .tab-header {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .tab-header.active {
            background: white;
            border-bottom-color: #2196F3;
            color: #2196F3;
        }
        
        .tab-content {
            padding: 20px;
            background: white;
        }
        
        .tab-content.hidden {
            display: none;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.8rem;
            z-index: 1000;
            max-width: 300px;
        }
        
        .debug-panel h6 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        
        .debug-panel div {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script src="juris.js"></script>
    <script>

        // Component Definitions
        const Counter = (props, context) => ({
            render: () => ({
                div: {
                    className: 'counter',
                    children: [
                        { button: {
                            text: '-',
                            onClick: () => {
                                const current = context.getState(props.statePath, 0);
                                context.setState(props.statePath, Math.max(0, current - 1));
                            },
                            disabled: () => context.getState(props.statePath, 0) <= 0
                        }},
                        { span: {
                            text: () => `${context.getState(props.statePath, 0)}`
                        }},
                        { button: {
                            text: '+',
                            onClick: () => {
                                const current = context.getState(props.statePath, 0);
                                context.setState(props.statePath, current + 1);
                            }
                        }}
                    ]
                }
            })
        });

        const UserCard = (props, context) => ({
            render: () => ({
                div: {
                    className: () => {
                        const selected = context.getState('selectedUser') === props.user.id;
                        return `user-card ${selected ? 'active' : ''}`;
                    },
                    onClick: () => context.setState('selectedUser', props.user.id),
                    children: [
                        { h5: { text: props.user.name }},
                        { p: { text: `Email: ${props.user.email}` }},
                        { p: { text: `Role: ${props.user.role}` }},
                        { p: { 
                            children: [
                                { span: {
                                    className: `status-indicator status-${props.user.status}`
                                }},
                                { span: { text: props.user.status.toUpperCase() }}
                            ]
                        }}
                    ]
                }
            })
        });

        const UserList = (props, context) => ({
            render: () => {
                const users = context.getState('users', []);
                const filter = context.getState('userFilter', '');
                const statusFilter = context.getState('statusFilter', 'all');
                const roleFilter = context.getState('roleFilter', 'all');
                
                const filteredUsers = users.filter(user => {
                    const matchesName = user.name.toLowerCase().includes(filter.toLowerCase());
                    const matchesStatus = statusFilter === 'all' || user.status === statusFilter;
                    const matchesRole = roleFilter === 'all' || user.role === roleFilter;
                    return matchesName && matchesStatus && matchesRole;
                });
                
                return {
                    div: {
                        children: [
                            { div: {
                                className: 'filter-controls',
                                children: [
                                    { input: {
                                        type: 'text',
                                        placeholder: 'Filter by name...',
                                        value: () => context.getState('userFilter', ''),
                                        oninput: (e) => context.setState('userFilter', e.target.value)
                                    }},
                                    { select: {
                                        value: () => context.getState('statusFilter', 'all'),
                                        onchange: (e) => context.setState('statusFilter', e.target.value),
                                        children: [
                                            { option: { value: 'all', text: 'All Status' }},
                                            { option: { value: 'online', text: 'Online' }},
                                            { option: { value: 'offline', text: 'Offline' }},
                                            { option: { value: 'away', text: 'Away' }}
                                        ]
                                    }},
                                    { select: {
                                        value: () => context.getState('roleFilter', 'all'),
                                        onchange: (e) => context.setState('roleFilter', e.target.value),
                                        children: [
                                            { option: { value: 'all', text: 'All Roles' }},
                                            { option: { value: 'admin', text: 'Admin' }},
                                            { option: { value: 'user', text: 'User' }},
                                            { option: { value: 'guest', text: 'Guest' }}
                                        ]
                                    }}
                                ]
                            }},
                            { div: {
                                children: () => filteredUsers.map(user => ({
                                    UserCard: { user, key: user.id }
                                }))
                            }},
                            { p: { 
                                text: () => `Showing ${filteredUsers.length} of ${users.length} users`
                            }}
                        ]
                    }
                };
            }
        });

        const ConditionalRenderer = (props, context) => ({
            render: () => ({
                div: {
                    children: () => {
                        const condition = context.getState(props.conditionPath, false);
                        return condition ? [props.trueComponent] : [props.falseComponent];
                    }
                }
            })
        });

        const ThemeProvider = (props, context) => ({
            render: () => ({
                div: {
                    className: () => context.getState('theme', 'light') === 'dark' ? 'dark-theme' : '',
                    children: [
                        { button: {
                            className: 'theme-toggle',
                            text: () => `Switch to ${context.getState('theme', 'light') === 'dark' ? 'Light' : 'Dark'} Theme`,
                            onclick: () => {
                                const current = context.getState('theme', 'light');
                                context.setState('theme', current === 'dark' ? 'light' : 'dark');
                            }
                        }},
                        ...props.children
                    ]
                }
            })
        });

        const PerformanceMonitor = (props, context) => ({
            render: () => ({
                div: {
                    className: 'performance-stats',
                    children: () => {
                        // Trigger reactivity by accessing entire state tree
                        const allState = context.getState('', {});
                        const stateKeys = Object.keys(allState);
                        const stats = context.juris.getStats();
                        
                        return [
                            { h5: { text: 'Framework Statistics' }},
                            { div: { text: `Components: ${stats.components.registered}` }},
                            { div: { text: `Instances: ${stats.components.instances}` }},
                            { div: { text: `Subscribers: ${stats.state.subscribers}` }},
                            { div: { text: `State Keys: ${stateKeys.length}` }},
                            { div: { text: `Render Time: ${Date.now() % 1000}ms` }}
                        ];
                    }
                }
            })
        });

        const ErrorBoundary = (props, context) => ({
            render: () => {
                const hasError = context.getState('errorBoundary.hasError', false);
                
                if (hasError) {
                    return {
                        div: {
                            className: 'error-boundary',
                            children: [
                                { h5: { text: 'Component Error Occurred' }},
                                { p: { text: 'Something went wrong in this component tree.' }},
                                { button: {
                                    text: 'Reset',
                                    onclick: () => context.setState('errorBoundary.hasError', false)
                                }}
                            ]
                        }
                    };
                }
                
                return {
                    div: {
                        children: props.children
                    }
                };
            }
        });

        const TabContainer = (props, context) => ({
            render: () => {
                const getActiveTab =()=>{
                    return context.getState(`tabs.${props.id}.active`, 0);
                }
                
                return {
                    div: {
                        className: 'tab-container',
                        children: [
                            { div: {
                                className: 'tab-headers',
                                children: () => props.tabs.map((tab, index) => ({
                                    button: {
                                        className: () => `tab-header ${index === getActiveTab() ? 'active' : ''}`,
                                        text: tab.title,
                                        onclick: () => context.setState(`tabs.${props.id}.active`, index)
                                    }
                                }))
                            }},
                            { div: {
                                className: 'tab-content',
                                children: () => [
                                    props.tabs[getActiveTab()].content
                                ]
                            }}
                        ]
                    }
                };
            }
        });

        const AsyncLoader = (props, context) => {
            const loadData = () => {
                context.setState(`async.${props.id}.loading`, true);
                context.setState(`async.${props.id}.error`, null);
                
                // Simulate async operation
                setTimeout(() => {
                    if (Math.random() > 0.2) {
                        context.setState(`async.${props.id}.data`, {
                            message: 'Data loaded successfully!',
                            timestamp: new Date().toLocaleTimeString()
                        });
                    } else {
                        context.setState(`async.${props.id}.error`, 'Failed to load data');
                    }
                    context.setState(`async.${props.id}.loading`, false);
                }, 1500);
            };

            return {
                render: () => {
                    const loading = context.getState(`async.${props.id}.loading`, false);
                    const data = context.getState(`async.${props.id}.data`, null);
                    const error = context.getState(`async.${props.id}.error`, null);
                    
                    if (loading) {
                        return {
                            div: {
                                children: [
                                    { span: { className: 'loading-spinner' }},
                                    { span: { text: ' Loading...' }}
                                ]
                            }
                        };
                    }
                    
                    if (error) {
                        return {
                            div: {
                                children: [
                                    { p: { text: `Error: ${error}` }},
                                    { button: {
                                        text: 'Retry',
                                        onclick: loadData
                                    }}
                                ]
                            }
                        };
                    }
                    
                    if (data) {
                        return props.renderData(data);
                    }
                    
                    return {
                        div: {
                            children: [
                                { button: {
                                    text: 'Load Data',
                                    onclick: loadData
                                }}
                            ]
                        }
                    };
                }
            };
        };

        const Spreader = (props, context) => ({
            render: () => {
                const items = context.getState(props.dataPath, []);
                return {
                    div: {
                        children: () => items.map((item, index) => 
                            props.renderItem(item, index, context)
                        )
                    }
                };
            }
        });

        const StateBasedComponent = (props, context) => ({  // ← Direct object return
            render: () => {
                const getStatePathValue = () => {
                    return context.getState(props.statePath, props.defaultValue);
                }
                 return props.renderFunction(getStatePathValue(), context);
            }
        });

        const DebugPanel = (props, context) => ({
            render: () => {
                const stats = context.juris.getStats();
                return {
                    div: {
                        className: 'debug-panel',
                        children: [
                            { h6: { text: 'Debug Info' }},
                            { div: { text: () => `Time: ${new Date().toLocaleTimeString()}` }},
                            { div: { text: () => `Components: ${context.juris.getStats().components.registered}` }},
                            { div: { text: () => `Selected User: ${context.getState('selectedUser', 'None')}` }},
                            { div: { text: () => `Theme: ${context.getState('theme', 'light')}` }},
                            { div: { text: () => `Counters: Basic=${context.getState('counter.basic', 0)}, Advanced=${context.getState('counter.advanced', 0)}` }}
                        ]
                    }
                };
            }
        });

        // Initialize sample data
        const sampleUsers = [
            { id: 1, name: 'John Doe', email: 'john@example.com', role: 'admin', status: 'online' },
            { id: 2, name: 'Jane Smith', email: 'jane@example.com', role: 'user', status: 'away' },
            { id: 3, name: 'Bob Johnson', email: 'bob@example.com', role: 'user', status: 'offline' },
            { id: 4, name: 'Alice Brown', email: 'alice@example.com', role: 'guest', status: 'online' },
            { id: 5, name: 'Charlie Wilson', email: 'charlie@example.com', role: 'admin', status: 'online' }
        ];

        // Initialize Juris with all components
        const juris = new Juris({
            states: {
                users: sampleUsers,
                counter: { basic: 0, advanced: 0 },
                theme: 'light',
                showAdvanced: false
            },
            components: {
                Counter,
                UserCard,
                UserList,
                ConditionalRenderer,
                ThemeProvider,
                PerformanceMonitor,
                ErrorBoundary,
                TabContainer,
                AsyncLoader,
                Spreader,
                StateBasedComponent,
                DebugPanel
            },
            layout: {
                div: {
                    className: 'test-container',
                    children: [
                        { div: {
                            className: 'header',
                            children: [
                                { h1: { text: 'Juris Component Composition Test Suite' }},
                                { p: { text: 'Comprehensive testing of all component composition patterns' }}
                            ]
                        }},
                        
                        { ThemeProvider: {
                            children: [
                                { div: {
                                    className: 'test-grid',
                                    children: [
                                        // Basic State Components
                                        { div: {
                                            className: 'test-section',
                                            children: [
                                                { h3: { text: '1. State-Based Counters' }},
                                                { div: {
                                                    className: 'test-component',
                                                    children: [
                                                        { h4: { text: 'Basic Counter' }},
                                                        { Counter: { statePath: 'counter.basic' }}
                                                    ]
                                                }},
                                                { div: {
                                                    className: 'test-component',
                                                    children: [
                                                        { h4: { text: 'Advanced Counter' }},
                                                        { Counter: { statePath: 'counter.advanced' }}
                                                    ]
                                                }}
                                            ]
                                        }},
                                        
                                        // Conditional Rendering
                                        { div: {
                                            className: 'test-section',
                                            children: [
                                                { h3: { text: '2. Conditional Rendering' }},
                                                { div: {
                                                    className: 'test-component',
                                                    children: [
                                                        { h4: { text: 'Show/Hide Advanced' }},
                                                        { button: {
                                                            text: () => juris.getState('showAdvanced', false) ? 'Hide Advanced' : 'Show Advanced',
                                                            onclick: () => {
                                                                const current = juris.getState('showAdvanced', false);
                                                                juris.setState('showAdvanced', !current);
                                                            }
                                                        }},
                                                        { ConditionalRenderer: {
                                                            conditionPath: 'showAdvanced',
                                                            trueComponent: {
                                                                div: {
                                                                    children: [
                                                                        { h5: { text: 'Advanced Settings' }},
                                                                        { PerformanceMonitor: {} }
                                                                    ]
                                                                }
                                                            },
                                                            falseComponent: {
                                                                p: { text: 'Advanced settings hidden' }
                                                            }
                                                        }}
                                                    ]
                                                }}
                                            ]
                                        }},
                                        
                                        // User List with Filters
                                        { div: {
                                            className: 'test-section',
                                            children: [
                                                { h3: { text: '3. Filtered User List' }},
                                                { UserList: {} }
                                            ]
                                        }},
                                        
                                        // Tab Container
                                        { div: {
                                            className: 'test-section',
                                            children: [
                                                { h3: { text: '4. Tab Container' }},
                                                { TabContainer: {
                                                    id: 'main-tabs',
                                                    tabs: [
                                                        {
                                                            title: 'Overview',
                                                            content: {
                                                                div: {
                                                                    children: [
                                                                        { h4: { text: 'Application Overview' }},
                                                                        { p: { text: 'This is the overview tab content.' }},
                                                                        { PerformanceMonitor: {} }
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            title: 'Settings',
                                                            content: {
                                                                div: {
                                                                    children: [
                                                                        { h4: { text: 'Application Settings' }},
                                                                        { p: { text: 'Configure your application here.' }},
                                                                        { Counter: { statePath: 'settings.counter' }}
                                                                    ]
                                                                }
                                                            }
                                                        },
                                                        {
                                                            title: 'Debug',
                                                            content: {
                                                                div: {
                                                                    children: [
                                                                        { h4: { text: 'Debug Information' }},
                                                                        { PerformanceMonitor: {} }
                                                                    ]
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }}
                                            ]
                                        }},
                                        
                                        // Async Loader
                                        { div: {
                                            className: 'test-section',
                                            children: [
                                                { h3: { text: '5. Async Data Loader' }},
                                                { AsyncLoader: {
                                                    id: 'sample-data',
                                                    renderData: (data) => ({
                                                        div: {
                                                            children: [
                                                                { h4: { text: 'Loaded Data:' }},
                                                                { p: { text: data.message }},
                                                                { p: { text: `Loaded at: ${data.timestamp}` }}
                                                            ]
                                                        }
                                                    })
                                                }}
                                            ]
                                        }},
                                        
                                        // Spreader Pattern
                                        { div: {
                                            className: 'test-section',
                                            children: [
                                                { h3: { text: '6. Spreader Pattern' }},
                                                { div: {
                                                    className: 'test-component',
                                                    children: [
                                                        { h4: { text: 'Admin Users Only' }},
                                                        { Spreader: {
                                                            dataPath: 'users',
                                                            renderItem: (user, index, context) => {
                                                                if (user.role === 'admin') {
                                                                    return { UserCard: { user, key: user.id }};
                                                                }
                                                                return null;
                                                            }
                                                        }}
                                                    ]
                                                }}
                                            ]
                                        }},
                                        
                                        // State-Based Dynamic Component
                                        { div: {
                                            className: 'test-section',
                                            children: ()=>[
                                                { h3: { text: '7. State-Based Rendering' }},
                                                { StateBasedComponent: {
                                                    statePath: 'counter.basic',
                                                    defaultValue: 0,
                                                    renderFunction: (value, context) => {
                                                        const getStatePathValue =()=>{
                                                            return context.getState('counter.basic', 0);
                                                        }
                                                        
                                                        return ({
                                                        div: {
                                                            children:()=>[
                                                                { h4: { text: 'Dynamic Content Based on Counter' }},
                                                                { p: { text: `Counter value: ${getStatePathValue()}` }},
                                                                {
                                                                    div: {
                                                                        className: getStatePathValue() > 5 ? 'high-value' : 'low-value',
                                                                        children: [
                                                                        getStatePathValue() === 0 ? { p: { text: '🔴 Zero state' }} :
                                                                        getStatePathValue() < 3 ? { p: { text: '🟡 Low value' }} :
                                                                        getStatePathValue() < 6 ? { p: { text: '🟢 Medium value' }} :
                                                                            { p: { text: '🔥 High value!' }}
                                                                        ]
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    })
                                                    }
                                                }
                                            }
                                            
                                            ]
                                        }},
                                        
                                        // Error Boundary
                                        { div: {
                                            className: 'test-section',
                                            children: [
                                                { h3: { text: '8. Error Boundary' }},
                                                { div: {
                                                    className: 'test-component',
                                                    children: [
                                                        { button: {
                                                            text: 'Trigger Error',
                                                            onclick: () => juris.setState('errorBoundary.hasError', true)
                                                        }},
                                                        { ErrorBoundary: {
                                                            children: [
                                                                { p: { text: 'This content is protected by an error boundary.' }},
                                                                { Counter: { statePath: 'counter.protected' }}
                                                            ]
                                                        }}
                                                    ]
                                                }}
                                            ]
                                        }}
                                    ]
                                }}
                            ]
                        }},
                        
                        { DebugPanel: {} }
                    ]
                }
            }
        });

        // Render the application
        juris.render();

        // Expose juris to global scope for debugging
        window.juris = juris;
        console.log('Juris test suite loaded. Access via window.juris');
    </script>
</body>
</html>